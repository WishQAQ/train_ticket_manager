<template>
  <div class="orderDetails" :style="{paddingBottom: roleType === 0 && urlType === 'add'? '80px': '20px'}" v-loading="loading">
    <div class="order_header" v-if="urlType !== 'add' || addHeaderShow">
      <div class="header_title" @click="openHeaderDetailsBtn">
        <i :class="headerDetails?'el-icon-remove-outline':'el-icon-circle-plus-outline'"/>
        订单Q群原始信息
      </div>
      <el-button class="header_btn" v-if="urlType !== 'add' && this.orderInfo.source_file && roleType === 0" @click="filesDownload">源文件下载</el-button>
    </div>

    <!-- Q群信息展开 -->
    <el-collapse-transition>
      <div class="header_header_details" v-show="headerDetails">
        <el-input
            placeholder="暂无需求信息"
            type="textarea"
            resize="none"
            :rows="8"
            v-model="orderInfo.group_origin_data || saveGroupMessage"
            disabled>
        </el-input>
      </div>
    </el-collapse-transition>

    <div class="order_header_add" v-if="urlType === 'add' && roleType === 0">
      <div class="add_title">{{addHeaderShow?'智能识别信息':'订单Q群原始信息'}}</div>
      <div class="add_input">
        <el-input
            placeholder="陈晶 21:30:03
123456789
11/11深圳——无锡G2158
刘燕芬 440104195505163426
廖伟佳 440104195104073411
03月11日遂宁——南充G2902、03-13南充——遂宁G2905
戚薇310110196211056302
杨国妹310110196211056302儿童票
01\12厦门北—桂林G2158、11/11桂林——上海G2158、11.11日上海——桂林G2158、11.11日桂林——厦门北G2158
杨星310110196211056302
谭琦31011019621105630儿童票"
            type="textarea"
            resize="none"
            :rows="8"
            v-model="AddGroupOriginData">
        </el-input>
      </div>
      <el-button v-if="!addBtnType" class="add_btn" @click="saveGroupBtn()">保存</el-button>
      <el-button v-if="addBtnType" class="add_btn" @click="addGroupBtn" v-loading="addBtnDisabled">识别</el-button>
    </div>

    <!-- 用户初始信息 -->
    <div class="order_info">
      <div class="info_header">
        <p class="title">订单号</p>
        <div class="info_header_table">
<!--          <div>{{orderInfo.order_sn}}</div>-->
          <el-input clearable @input="change($event)" v-model="orderInfo.order_sn" :disabled="inputDisabled || urlType === 'edit'"/>
          <div>
            <span>客户商</span>
            <el-select filterable @change="getBillerData(orderInfo.cname)" v-model="orderInfo.cname" :disabled="inputDisabled" :placeholder="inputDisabled?'':'请选择客户商'">
              <el-option
                  v-for="item in customerList"
                  :key="item.id"
                  :label="item.name"
                  :value="item.identity">
              </el-option>
            </el-select>
          </div>
          <div>
            <span>发单人</span>
            <el-select filterable v-model="orderInfo.dName" :disabled="inputDisabled" :placeholder="inputDisabled?'':'请选择发单人'">
              <el-option
                  v-for="item in billerList"
                  :key="item.id"
                  :label="item.name"
                  :value="item.id">
              </el-option>
            </el-select>
          </div>
          <div v-if="urlType !== 'add'">
            <span>新订单号</span>
            <el-input
                @input="change($event)"
                :placeholder="inputDisabled?'':'请输入新订单号'"
                v-model="orderInfo.old_order_sn"
                :disabled="inputDisabled">
            </el-input>
          </div>
        </div>
      </div>
      <div class="info_address">
        <p class="title">收货地址</p>
        <div class="info_address_table">
          <el-input
              :placeholder="inputDisabled?'暂无收货地址':'请填写收货地址'"
              v-model="orderInfo.receiving_address"
              :disabled="inputDisabled">
          </el-input>
        </div>
      </div>
      <div class="info_content">
        <p class="title">备注信息</p>
        <div class="info_content_table">
          <div class="info_remarks">
            <el-input
                :placeholder="inputDisabled?'暂无备注信息':'请输入备注信息'"
                type="textarea"
                :rows="3"
                maxlength="180"
                show-word-limit
                resize="none"
                v-model="orderInfo.remarks"
                :disabled="inputDisabled">
            </el-input>
          </div>
          <div class="info_upload_image" v-if="urlType !== 'add'">
<!--            <div v-if="urlType === 'edit'">-->
<!--              <UploadLeaflet-->
<!--                  v-if="show_user_data"-->
<!--                  ref="uploadUserData"-->
<!--                  v-on:uploadAddress="uploadIdPhoto"-->
<!--                  :defaultPhoto="orderInfo.certificates || ''"-->
<!--                  :messageText="'证件照片'"/>-->
<!--              <UploadLeaflet-->
<!--                  v-else-->
<!--                  ref="uploadUserData"-->
<!--                  v-on:uploadAddress="uploadIdPhoto"-->
<!--                  :defaultPhoto="orderInfo.certificates || ''"-->
<!--                  :messageText="'证件照片'"/>-->
<!--            </div>-->
<!--            <PublicImage v-else :url="orderInfo.certificates" :preview="urlType === 'details'"/>-->
            <el-button type="primary" @click="openAddUserPhotoBtn"><i class="el-icon-camera-solid"/> 证件照片</el-button>
          </div>
        </div>
      </div>
      <div class="add_upload" v-if="urlType === 'add' && roleType === 0">
        <div class="title">文件上传</div>
        <div class="add_user_photo_btn"><el-button type="primary" @click="openAddUserPhotoBtn"><i class="el-icon-camera-solid"/> 证件照片</el-button></div>
        <div class="add_user_photo_btn"><el-button type="primary" @click="openAddUserFileBtn"><i class="el-icon-upload"/> 源文件</el-button></div>
<!--        <UploadLeaflet v-on:uploadAddress="uploadUserData" :messageText="'证件照片'"/>-->

      </div>
      <div class="info_upload" v-if="urlType === 'edit' || orderInfo.ticket_photos.length > 0 && roleType === 0">
        <div class="upload_image_main">
          <PublicImage
              :preview="orderInfo.ticket_photos.length > 0"
              v-for="(item,index) in orderInfo.ticket_photos"
              :previewList="orderInfo.ticket_photos"
              :deleteMask="urlType === 'edit'"
              @deleteUploadImage="deleteUploadTicketImage"
              :key="index"
              :url="item || null">
          </PublicImage>
          <UploadLeaflet
              v-if="urlType === 'edit'"
              ref="uploadImage"
              v-on:uploadAddress="uploadIdTicketPhoto"
              :messageText="'车票照片'"/>
        </div>
        <div class="info_upload_right_box">
          <div class="info_message_box">
            <p>车票照片</p>
            <el-button v-if="urlType === 'edit' && roleType === 0" @click="openUploadBox" type="primary" size="mini">车票/快递单上传</el-button>
            <el-button v-else type="primary" size="mini" @click="downAllPhoto"><a>下载所有图片</a></el-button>
          </div>
          <div class="info_message_button" v-if="urlType !== 'details' && roleType === 0">
            <el-button
                v-if="urlType === 'edit' && roleType === 0"
                type="success"
                v-loading="allAddSubmitLoading"
                :disabled="allAddSubmitLoading"
                @click="allEditSubmit">
              全部保存
            </el-button>
          </div>
        </div>
      </div>
      <!-- 新增订单批量修改 -->
      <div class="add_select_editTable" v-if="roleType === 0 && addTrainTableArray.length > 0">
        <div class="add_edit_table_box">
          <div class="title">批量修改</div>
          <div class="add_edit_input_box">
            <el-select style="width: 120px" clearable v-model="selectAllEditTable.ticket_species" placeholder="票种">
              <el-option label="成人票" value="成人票"/>
              <el-option label="儿童票" value="儿童票"/>
            </el-select>
            <el-select style="width: 120px" clearable v-model="selectAllEditTable.ticket_type" placeholder="车票类型">
              <el-option label="网票" value="网票"/>
              <el-option label="纸票" value="纸票"/>
              <el-option label="电子票" value="电子票"/>
            </el-select>
            <el-input style="width: 100px" clearable v-model="selectAllEditTable.missed_meals_money" placeholder="误餐费"/>
            <el-input style="width: 300px" clearable v-model="selectAllEditTable.remarks" placeholder="请输入备注"/>

          </div>
        </div>
        <el-button type="primary" @click="addSelectAllTableData">修 改</el-button>
      </div>
    </div>

    <!-- 新增表格 -->
    <div v-if="urlType === 'add' && roleType === 0">
      <div class="add_table" v-for="(item, index) in addTrainTableArray" :key="index">
        <div class="addOrderTable" :style="{border: '1px solid '+ item.color}">
<!--          <div class="add_table_header">-->
<!--            <el-button>隐藏</el-button>-->
<!--            <el-button>增加表</el-button>-->
<!--            <el-button>删除表</el-button>-->
<!--            <el-button>内容清空</el-button>-->
<!--            <el-button>批量删除</el-button>-->
<!--            <el-button>保存</el-button>-->
<!--          </div>-->

          <div class="table"
               v-for="(cItem, cIndex) in item.info"
               :key="cIndex">
            <!-- 单程表头 -->
            <div class="table_header">
              <div style="display: flex;align-items: center">
                行程时间：
                <el-date-picker
                    size="mini"
                    :clearable="false"
                    v-model="cItem.riding_time"
                    type="date"
                    placeholder="选择日期">
                </el-date-picker>
              </div>
              <div class="table_header_train">
                <p style="width: 120px"><el-input size="mini" v-model="cItem.initial_station" placeholder="发站"></el-input></p>
                <div style="width: 100px"><el-input size="mini" v-model="cItem.trips_number" placeholder="车次"></el-input></div>
                <p style="width: 120px"><el-input size="mini" v-model="cItem.stop_station" placeholder="到站"></el-input></p>
              </div>
              <div>行程类型：{{item.type === 0? '单程':
                item.type === 1? '往返':
                item.type === 2? '中转':
                item.type === 3? '中转往返': ''}}</div>
            </div>

            <el-table
                stripe
                border
                @select="tableSelect"
                @select-all="tableSelect"
                ref="multipleTable"
                tooltip-effect="dark"
                :data="cItem.passenger"
                class="add_order_table"
                style="width: 100%">
              <el-table-column
                  width="60"
                  align="center"
                  label="序">
                <template slot-scope="scope">{{scope.$index + 1}}</template>
              </el-table-column>
              <el-table-column
                  type="selection"
                  align="center"
                  width="50">
              </el-table-column>
              <el-table-column
                  label="姓名">
                <template slot-scope="scope">
                  <el-input size="mini" v-model="scope.row.name"/>
                </template>
              </el-table-column>
              <el-table-column
                  label="身份证信息">
                <template slot-scope="scope">
                  <el-input size="mini" v-model="scope.row.IDCard"/>
                </template>
              </el-table-column>
              <el-table-column
                  label="票种">
                <template slot-scope="scope">
                  <el-select @input="change($event)" size="mini" v-model="scope.row.ticket_species" placeholder="请选择">
                    <el-option label="成人票" value="成人票"/>
                    <el-option label="儿童票" value="儿童票"/>
                  </el-select>
                </template>
              </el-table-column>
              <el-table-column
                  label="车票类型">
                <template slot-scope="scope">
                  <el-select @input="change($event)" size="mini" v-model="scope.row.ticket_type" placeholder="请选择">
                    <el-option label="网票" value="网票"/>
                    <el-option label="纸票" value="纸票"/>
                    <el-option label="电子票" value="电子票"/>
                  </el-select>
                </template>
              </el-table-column>
              <el-table-column
                  label="误餐费">
                <template slot-scope="scope">
                  <el-input size="mini" v-model="scope.row.missed_meals_money"/>
                </template>
              </el-table-column>
              <el-table-column
                  label="备注">
                <template slot-scope="scope">
                  <el-input size="mini" v-model="scope.row.remarks"/>
                </template>
              </el-table-column>
              <el-table-column
                  width="80px"
                  align="center"
                  label="操作">
                <template slot-scope="scope">
                  <el-button size="mini" @click="deleteList(cItem.passenger,scope.row)">删除</el-button>
                </template>
              </el-table-column>
            </el-table>
          </div>

        </div>
      </div>

      <div class="submitAllDataBtn" v-if="urlType !== 'details' && addTrainTableArray.length > 0">
        <el-button
            type="primary"
            :disabled="allAddSubmitLoading"
            v-loading="allAddSubmitLoading"
            @click="allAddSubmit">
          全部保存
        </el-button>
      </div>

    </div>

    <!-- 详情or编辑 表格 -->
    <div v-if="urlType !== 'add'">
      <!-- 广告 -->
      <div class="order_carousel" v-if="urlType === 'details' && orderInfo.news === []">
        <div class="carousel_main">
          <el-carousel class="carousel_main" height="40px" direction="vertical" loop autoplay arrow="none" indicator-position="none">
            <el-carousel-item v-for="(item ,index) in orderInfo.news" :key="index">
              <div class="medium" @click="openNewsCenter(item)">{{ item.title }}</div>
            </el-carousel-item>
            <div v-if="!orderInfo.news">暂无新闻</div>
          </el-carousel>
        </div>
      </div>

      <div class="order_passenger_search">
        <div class="search_box">
          <el-input v-model="passengerSearch.info" clearable placeholder="请输入乘客信息/支付账号/流水账号/12306账号"/>
          <el-input v-model="passengerSearch.train_number" clearable placeholder="请输入车次"/>
          <el-input v-model="passengerSearch.departure_station" clearable placeholder="请输入发站地址"/>
          <el-input v-model="passengerSearch.arrive_station" clearable placeholder="请输入到站地址"/>
          <el-date-picker
              v-model="passengerSearch.newTripTime"
              type="date"
              value-format="timestamp"
              placeholder="请选择行程时间">
          </el-date-picker>
          <el-date-picker
              value-format="timestamp"
              v-model="passengerSearch.newDrawBillTime"
              type="date"
              placeholder="请选择出票时间">
          </el-date-picker>
          <el-select v-model="passengerSearch.ticket_type" clearable placeholder="请选择票类">
            <el-option label="电子票" value="0"/>
            <el-option label="网票" value="1"/>
            <el-option label="纸票" value="2"/>
          </el-select>
          <el-select v-model="passengerSearch.ticket_status" clearable placeholder="请选择车票状态">
            <el-option label="未出票" value="0"/>
            <el-option label="已出票" value="1"/>
            <el-option label="已取消票" value="2"/>
            <el-option label="已改签" value="3"/>
            <el-option label="已退票" value="4"/>
          </el-select>
          <el-button @click="passengerSearchBtn">搜索</el-button>
        </div>
        <div class="search_btn">
          <div>
            <el-button v-if="roleType === 0" @click="hiddenTable">{{showTableType?'隐藏':'显示'}}</el-button>
            <el-button type="warning" v-if="urlType === 'details' && roleType === 0" @click="openEditBtn">编辑订单</el-button>
            <el-button type="primary" v-if="urlType !== 'add' && roleType === 0" @click="selectJumpPay">批量购票</el-button>
            <el-button type="warning"
                       @click="openBatchEdit"
                       :loading="batchEditLoading"
                       v-if="urlType === 'edit' && roleType === 0">
              批量修改</el-button>
            <el-button type="danger"
                       @click="deleteOrderList"
                       v-if="urlType === 'edit' && roleType === 0">
              批量删除</el-button>
            <el-button type="primary" v-if="urlType === 'edit' && roleType === 0" @click="addStrokeBtn">添加行程</el-button>
          </div>
<!--          <el-button v-if="urlType === 'edit'">导出菜单</el-button>-->
        </div>
      </div>

      <!-- 订单表格 -->
      <div class="order_passenger" v-if="showPassengersTable">
        <div class="passenger_table"
             v-for="(item,index) in passengerInfo"
             :style="{border: '1px solid '+ item.color}"
             :key="index">
          <div class="train_message">
            <div>合计票款：{{item.ticketPrice || '0.00'}} 元</div>
            <div style="display: inline-flex;align-items: center" v-if="tableRoleStatus.express_fee.show">
              快递费：
              <el-input
                  size="mini"
                  v-if="urlType === 'edit' && tableRoleStatus.express_fee.read"
                  :placeholder="item.express_fee"
                  v-model="newEditTableForm[item.itemIndex].express_fee"
                  @blur="editTableHeaderRows(item, 'express_fee', item.express_fee, newEditTableForm[item.itemIndex].express_fee)"/>
              <span v-else>{{item.express_fee || '0.00'}}</span>&nbsp;元
            </div>
            <div style="display: inline-flex;align-items: center" v-if="tableRoleStatus.refund_fare.show">
              退改交通费：
              <el-input
                  v-if="urlType === 'edit' && tableRoleStatus.refund_fare.read"
                  size="mini"
                  :placeholder="item.refund_fare"
                  v-model="newEditTableForm[item.itemIndex].refund_fare"
                  @blur="editTableHeaderRows(item, 'refund_fare', item.refund_fare, newEditTableForm[item.itemIndex].refund_fare)"/>
              <span v-else>{{item.refund_fare || '0.00'}}</span>&nbsp;元
            </div>
            <div>合计：{{item.ticketNumber || '0'}} 张</div>
            <div class="train_route">
              行程类型：
              {{item.route_config.length === 1 ?'单程' :
              item.route_type === 1 ?'往返' :
              item.route_type === 2 ?'中转' :
              item.route_type === 3 ?'中转往返' :''}}
            </div>

            <div class="table_header_btn">
              <el-button
                  class="addUserListBtn"
                  @click="addTableUserBtn(item)"
                  type="primary"
                  size="mini"
                  v-if="urlType === 'edit'">
                添加乘客
              </el-button>
            </div>
          </div>
          <div
              v-for="(cItem,cIndex) in item.route_config"
              :key="cIndex"
              class="passenger_table_route">
            <div class="train_route_message" v-if="showPassengersTable">
<!--              <div style="margin-right: 15px"-->
<!--                   v-if="urlType === 'edit'">-->
<!--                <el-checkbox @change="checkedOrderData(item,cItem)" v-model="checkedOrderBtn"></el-checkbox>-->
<!--              </div>-->
              <div>行程时间：<span>{{$getTimeYear(cItem.riding_time * 1000)}}</span></div>
                <div>
                  乘车区间：
                  <el-tooltip class="item" :disabled="urlType !== 'edit'" effect="dark" content="点击修改路线信息" placement="top">
                    <div :class="['ticket_message',{'edit_message':urlType === 'edit'}]" @click="openEditTicketBrn(item,cItem)">
                      <span>{{cItem.departure_station}}</span>
                      <p>{{cItem.trips_number}}</p>
                      <span>{{cItem.arrival_station}}</span>
                    </div>
                  </el-tooltip>

                </div>
              <div v-if="tableRoleStatus.ticket_check.show">
                检票口：
                <el-input
                    size="mini"
                    v-model="newEditTableRouteForm[cItem.cItemIndex].ticket_check"
                    v-if="urlType === 'edit' && tableRoleStatus.ticket_check.read"
                    :placeholder="cItem.ticket_check"
                    @blur="editTableHeaderBows(item, cItem, 'ticket_check', cItem.ticket_check, newEditTableRouteForm[cItem.cItemIndex].ticket_check)"/>
                <span v-else>{{cItem.ticket_check}}</span>
              </div>
              <div v-if="tableRoleStatus.ticket_check.show">
                发到站时间：
<!--                <el-input-->
<!--                    size="mini"-->
<!--                    v-model="newEditTableRouteForm[cItem.cItemIndex].ticket_check"-->
<!--                    v-if="urlType === 'edit' && tableRoleStatus.ticket_check.read"-->
<!--                    :placeholder="cItem.ticket_check"-->
<!--                    @blur="editTableHeaderBows(item, cItem, 'ticket_check', cItem.ticket_check, newEditTableRouteForm[cItem.cItemIndex].ticket_check)"/>-->
                <span v-if="cItem.drive_time && cItem.arrival_time">{{cItem.drive_time + ' - ' + cItem.arrival_time}}</span>
                <span v-else style="font-weight: unset">请查看图片</span>
              </div>
              <el-button
                  class="addUserListBtn"
                  @click="deleteTableUserBtn(item,cItem)"
                  type="danger"
                  size="mini"
                  v-if="urlType === 'edit'">
                删除路线
              </el-button>
            </div>
            <TrainTimesTable
                v-if="showTrainTable"
                v-on:tableRowsData="editTableRows"
                v-on:checkTableData="checkTableList"
                v-on:jumpPayTicket="jumpPayTicket"
                v-on:jumpEditTicket="jumpEditTicket"
                v-on:tableRowsUserData="tableRowsUserData"
                :tableRoleStatus="tableRoleStatus"
                :tableModify="urlType"
                :index="index"
                :cIndex="cIndex"
                :showTableRows="showTableType"
                :orderInfo="item"
                :tableData="cItem.passengers.data"
                :dbTableData="dbPassengerInfo[index].route_config[cIndex].passengers.data">
            </TrainTimesTable>
          </div>
        </div>
      </div>

      <div class="order_add_remarks" v-if="urlType !== 'add' && roleType === 0">
        <div style="flex: 1">
          <el-input type="textarea" :rows="3" placeholder="请填写需要新添加的备注信息" v-model="addRemarksMessage"/></div>
        <el-button @click="submitNewRemarsk" type="primary">提交备注</el-button>
      </div>

      <div class="order_details_bottom" v-if="roleType === 0">
        <!-- 订单备注表格 -->
        <div class="order_bottom_table">
          <div class="table_header">备注信息</div>
          <div class="table_main">
            <el-table
                stripe
                width="100%"
                :data="orderRemarks"
                class="orderRemarksTable"
                border>
              <el-table-column
                  label="序号"
                  align="center"
                  type="index"
                  width="50px">
<!--                <template slot-scope="scope">-->
<!--                  {{(remarksPage - 1) * remarksPer_page + scope.$index + 1}}-->
<!--                </template>-->
              </el-table-column>
              <el-table-column
                  width="110"
                  show-overflow-tooltip
                  label="备注人"
                  prop="nickname">
              </el-table-column>
              <el-table-column
                  show-overflow-tooltip
                  label="备注"
                  prop="remarks">
              </el-table-column>
              <el-table-column
                  width="145"
                  label="时间">
                <template slot-scope="scope">
                  <div style="font-size: 12px">{{$getTime(scope.row.updated_at * 1000)}}</div>
                </template>
              </el-table-column>
            </el-table>
          </div>
          <Pagination
              ref="pagination"
              :pageData="paginationRemarksList"
              @jumpSize="jumpRemarksSize"
              @jumpPage="jumpRemarksPage">
          </Pagination>

        </div>

        <!-- 订单操作日志表格 -->
        <div class="order_bottom_table">
          <div class="table_header">操作日志</div>
          <div class="table_main">
            <el-table
                stripe
                width="100%"
                :data="orderLog"
                class="orderLogTable"
                border>
              <el-table-column
                  label="序号"
                  align="center"
                  type="index"
                  width="50px">
<!--                <template slot-scope="scope">-->
<!--                  {{(logPage - 1) * logPer_page + scope.$index + 1}}-->
<!--                </template>-->
              </el-table-column>
              <el-table-column
                  width="110"
                  show-overflow-tooltip
                  label="操作人"
                  prop="nickname">
              </el-table-column>
              <el-table-column
                  width="55"
                  show-overflow-tooltip
                  label="动作"
                  prop="action">
              </el-table-column>
              <el-table-column
                  width="85"
                  label="字段"
                  prop="field">
              </el-table-column>
              <el-table-column
                  show-overflow-tooltip
                  label="写入值"
                  prop="read_in">
              </el-table-column>
              <el-table-column
                  width="145"
                  label="时间">
                <template slot-scope="scope">
                  <div style="font-size: 12px">{{$getTime(scope.row.updated_at * 1000)}}</div>
                </template>
              </el-table-column>
            </el-table>
          </div>
          <Pagination
              ref="pagination"
              :pageData="paginationLogList"
              @jumpSize="jumpLogSize"
              @jumpPage="jumpLogPage">
          </Pagination>

        </div>
      </div>

      <!--
      <div class="submitAllDataBtn" v-if="urlType !== 'details' && roleType === 0">
        <el-button
            v-if="urlType === 'edit'"
            type="primary"
            v-loading="allAddSubmitLoading"
            :disabled="allAddSubmitLoading"
            @click="allEditSubmit">
          全部保存
        </el-button>
      </div>
      -->

    </div>

    <!-- 添加证件照片弹窗 -->
    <el-dialog
        v-dialogDrag
        title="证件照片上传"
        width="810px"
        custom-class="add_user_photo_dialog"
        :visible.sync="addUserPhotoDialog">
      <div class="dialog_main">
        <PublicImage
            :preview="orderInfo.certificates.length > 0"
            v-for="(item,index) in orderInfo.certificates"
            :previewList="orderInfo.certificates"
            :deleteMask="urlType !== 'details'"
            @deleteUploadImage="deleteUserImage"
            :key="index"
            :url="item || null">
        </PublicImage>
        <UploadLeaflet
            v-if="urlType !== 'details'"
            ref="uploadImage"
            v-on:uploadAddress="uploadUserPhoto"
            :messageText="'证件照片'"/>
        <div class="not_photo_message" v-if="orderInfo.certificates.length < 1 && urlType === 'details'">暂无证件照片</div>
      </div>
    </el-dialog>

    <!-- 添加原始文件弹窗 -->
    <el-dialog
        v-dialogDrag
        title="源文件上传"
        width="810px"
        custom-class="add_user_photo_dialog"
        :visible.sync="addUserFileDialog">
      <div class="dialog_main">
        <div class="add_upload_files_box">
          <div class="add_upload_file_list" v-for="(item, index) in add_file_data" :key="index">
            <p>{{item.split('/').pop()}}</p>
            <span @click="deleteAddFileList(item,index)" class="el-icon-error"/>
          </div>
        </div>
        <UploadLeaflet
            v-if="urlType !== 'details'"
            ref="uploadFile"
            v-on:uploadAddress="uploadFileData"
            :messageText="'源文件'"/>
      </div>
    </el-dialog>

    <!-- 添加乘客弹窗 -->
    <el-dialog
        v-dialogDrag
        title="添加乘客"
        width="60%"
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        :show-close="false"
        custom-class="add_user_dialog"
        :visible.sync="addUserDialog">
      <div class="dialog_main">
        <div ref="add_user_table_header" class="order_table_header" v-for="(item,index) in userListHeader.info" :key="index">
          <div>
            行程类型：
            {{userListHeader.route_type === 0 ?'单程' :
            userListHeader.route_type === 1 ?'往返' :
            userListHeader.route_type === 2 ?'中转' :
            userListHeader.route_type === 3 ?'中转往返' :''}}
          </div>
          <div>行程时间：<span>{{$getTimeYear(item.riding_time * 1000)}}</span></div>
          <div>
            乘车区间：
            <span>{{item.departure_station}}</span>
            <p>{{item.trips_number}}</p>
            <span>{{item.arrival_station}}</span>
          </div>
          <div>车次：{{item.trips_number}}</div>
          <el-button
              style="margin-left: auto"
              v-if="userListHeader.info.length > 1"
              @click="deleteAddUserRoute(item,index,item.route_id)"
              plain
              size="mini"
              type="danger"
              icon="el-icon-delete"
              circle/>
        </div>

        <el-input
            type="textarea"
            class="order_user_message"
            :rows="5"
            resize="none"
            placeholder="请输入乘客信息。格式：姓名+身份证+（默认为成人票，如是儿童请加上儿童票）"
            v-model="addUserInfo">
        </el-input>

      </div>
      <div slot="footer" class="dialog-footer">
        <el-button @click="addUserDialog = false">取 消</el-button>
        <el-button type="primary" @click="submitAddUserDialog()">确 定</el-button>
      </div>
    </el-dialog>

    <!-- 批量修改 -->
    <el-dialog
        v-dialogDrag
        title="批量修改"
        width="30%"
        :lock-scroll="false"
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        :show-close="false"
        custom-class="batch_edit_dialog"
        :visible.sync="batchEditDialog">
      <div class="dialog_main"
           v-for="(item,index) in batchEditInfo"
           :key="index">
        <div class="main_box">
          <div class="main_box_title">原路线信息</div>
          <div class="main_box_content" :style="{ opacity: '.5'}">
            <div class="content_route" v-for="(cItem,cIndex) in item.route" :key="cIndex">
              <div>{{$getTimeYear(cItem.riding_time)}}</div>
              <div class="route_message">
                <span>{{cItem.departure_station}}</span>
                <p>{{cItem.trips_number}}</p>
                <span>{{cItem.arrival_station}}</span>
              </div>
            </div>
          </div>
        </div>
        <div class="main_box">
          <div class="main_box_title">车票状态</div>
          <div class="main_box_content">
            <el-select size="mini" v-model="item.ticket_status" placeholder="请选择">
              <el-option label="请选择" value="5"/>
              <el-option label="未出票" value="0"/>
              <el-option label="已出票" value="1"/>
              <el-option label="已取消票" value="2"/>
              <el-option label="已改签" value="3"/>
              <el-option label="已退票" value="4"/>
            </el-select>
          </div>
        </div>

        <!--出票 or 改签-->
        <div class="ticket_box" v-if="item.ticket_status !== '4' && item.ticket_status !== '2'">
          <div class="main_box">
            <div class="main_box_content">
              <div class="content_route" v-for="(cItem,cIndex) in item.route" :key="cIndex">
                <div class="content_edit_time">
                  <el-date-picker
                      size="mini"
                      @input="change($event)"
                      v-model="dbBatchEditInfo[index].route[cIndex].riding_time"
                      type="date">
                  </el-date-picker>
                </div>
                <div class="route_message edit_route_message" style="margin-top: 5px;margin-left: 0;width: 100%;justify-content: space-between">
                  <div style="width: 105px">
                    <el-input size="mini" clearable @input="change($event)" v-model="dbBatchEditInfo[index].route[cIndex].departure_station"/>
                  </div>
                  <div style="width: 60px">
                    <el-select size="mini" clearable @input="change($event)" v-model="item.directionOne" placeholder="">
                      <el-option label="东" value="东"/>
                      <el-option label="南" value="南"/>
                      <el-option label="西" value="西"/>
                      <el-option label="北" value="北"/>
                    </el-select>
                  </div>
                  <p style="margin: 0 5px"><el-input size="mini" clearable @input="change($event)" v-model="dbBatchEditInfo[index].route[cIndex].trips_number"/></p>
                  <div style="width: 105px"><el-input size="mini" clearable @input="change($event)" v-model="dbBatchEditInfo[index].route[cIndex].arrival_station"/></div>
                  <div style="width: 60px">
                    <el-select size="mini" clearable @input="change($event)" v-model="item.directionTwo" placeholder="">
                      <el-option label="东" value="东"/>
                      <el-option label="南" value="南"/>
                      <el-option label="西" value="西"/>
                      <el-option label="北" value="北"/>
                    </el-select>
                  </div>
              </div>
            </div>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">票类</div>
            <div class="main_box_content">
              <el-select size="mini" clearable @input="change($event)" @change="selectTicketType(item.ticket_type,index)" v-model="item.ticket_type" placeholder="请选择">
                <el-option label="电子票" value="3"/>
                <el-option label="网票" value="1"/>
                <el-option label="纸票" value="2"/>
              </el-select>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">席别</div>
            <div class="main_box_content">
              <el-select size="mini" clearable @input="change($event)" v-model="item.fwId" placeholder="请选择">
                <el-option
                    v-for="(o,i) in agentCategory"
                    :key="i"
                    :label="o.name"
                    :value="o.id">
                </el-option>
              </el-select>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">票价</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.ticket_price" placeholder="请输入票价"/>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">儿童票价</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.child_ticket_price" placeholder="请输入儿童票价"/>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">误餐费</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.missed_meals_money" placeholder="请输入误餐费"/>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">出票费</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.ticket_fare" placeholder="请输入出票费"/>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">支付账号</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.payment_account" placeholder="请输入支付账号"/>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">支付流水号</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.payment_flow_number" placeholder="请输入支付流水号"/>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">12306账号</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item['12306_account']" placeholder="请输入12306账号"/>
            </div>
          </div>
          <div class="main_box">
            <div class="main_box_title">12306密码</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.password" placeholder="请输入12306密码"/>
            </div>
          </div>
        </div>

<!--        <div class="ticket_box" v-if="item.ticket_status === '0'">-->

<!--          <div class="main_box">-->
<!--            <div class="main_box_title">误餐费</div>-->
<!--            <div class="main_box_content">-->
<!--              <el-input size="mini" clearable @input="change($event)" v-model="item.missed_meals_money" placeholder="请输入误餐费"/>-->
<!--            </div>-->
<!--          </div>-->
<!--          <div class="main_box">-->
<!--            <div class="main_box_title">席别</div>-->
<!--            <div class="main_box_content">-->
<!--              <el-select size="mini" clearable @input="change($event)" v-model="item.fwId" placeholder="请选择">-->
<!--                <el-option-->
<!--                    v-for="(o,i) in agentCategory"-->
<!--                    :key="i"-->
<!--                    :label="o.name"-->
<!--                    :value="o.id">-->
<!--                </el-option>-->
<!--              </el-select>-->
<!--            </div>-->
<!--          </div>-->
<!--        </div>-->

        <div class="ticket_box" v-if="item.ticket_status === '4'">

          <div class="main_box">
            <div class="main_box_title">退票款</div>
            <div class="main_box_content">
              <el-input size="mini" clearable @input="change($event)" v-model="item.refund_fee" placeholder="请输入退票款"/>
            </div>
          </div>
        </div>

        <el-button size="mini" :disabled="item.disabled" style="margin-top: 10px" type="primary" @click="saveEditBtn(item.ticket_status,item,item.route,index)">保存</el-button>

      </div>
      <div slot="footer" class="dialog-footer" style="justify-content: flex-end">
        <el-button size="mini" @click="closedEditDialog">关闭</el-button>
      </div>
    </el-dialog>

    <!-- 新闻详情弹窗 -->
    <el-dialog
        :title="'新闻详情 --- ' + newsDetailInfo.title"
        modal-append-to-body
        append-to-body
        :visible.sync="newsDetailDialog"
        custom-class="news_detail_dialog">
      <div class="detail_main">
        <div class="title">{{newsDetailInfo.title || '暂无文档标题' }}</div>
        <div class="content">{{newsDetailInfo.content || '暂无文档内容'}}</div>
        <div class="person_box">
          查看人： <span v-for="(item, index) in newsDetailInfo.person" :key="index">{{item.account}}</span>
        </div>
      </div>
    </el-dialog>

    <!-- 批量修改路线变更提示框 -->
    <el-dialog
        v-dialogDrag
        title="提示"
        modal-append-to-body
        append-to-body
        width="450px"
        :visible.sync="editRouteDialog"
        custom-class="edit_route_dialog">
      <div class="detail_main">
        <div>
          由于系统检测到原路线
          <div class="edit_route_info" style="display: inline-flex; font-weight: bold; font-size: 12px;margin-bottom: 15px">
            {{$getTimeYear(editRouteInfo[0].riding_time)}}
            {{editRouteInfo[0].departure_station}}
            <span style="margin: 0 8px;color: #409EFF;position: relative;top: -3px">{{editRouteInfo[0].trips_number}}</span>
            {{editRouteInfo[0].arrival_station}}
          </div>
        </div>
        <div>存在其他车票状态或新路线关键词被修改，是否保存相关信息将所选乘客移动到新路线？</div>
      </div>
      <div slot="footer" class="dialog-footer" style="justify-content: flex-end">
        <el-button @click="closedEditRoute">取消</el-button>
        <el-button type="primary" @click="submitEditRoute(editRouteInfo[0])">移动</el-button>
      </div>
    </el-dialog>

    <!-- 新增行程 -->
    <el-dialog
        v-dialogDrag
        title="新增行程"
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        :show-close="false"
        modal-append-to-body
        append-to-body
        width="650px"
        :visible.sync="addStrokeDialog"
        custom-class="add_stroke_dialog">
      <div class="detail_main">
        <el-radio-group size="mini" v-model="strokeTableType" @change="changeStrokeType">
          <el-radio-button label="单程"></el-radio-button>
          <el-radio-button label="往返"></el-radio-button>
          <el-radio-button label="中转"></el-radio-button>
          <el-radio-button label="中转往返"></el-radio-button>
        </el-radio-group>

<!--        <div @click="add">添加行程</div>-->

        <div class="add_stroke_table">
          <div class="table_header">
            <div class="header_box" ref="add_stroke_table_box" v-for="(item ,index) in addStrokeArr" :key="index">
              <div>
                <el-date-picker
                  v-model="item.riding_time"
                  style="width: 140px"
                  type="date"
                  placeholder="行程日期">
                </el-date-picker>
              </div>
              <div class="header_ticket">
                <el-input clearable v-model="item.initial_station" placeholder="输入发站"></el-input>
                <el-input class="ticket_number" clearable v-model="item.trips_number" placeholder="输入车次"></el-input>
                <el-input clearable v-model="item.stop_station" placeholder="输入到站"></el-input>
              </div>
              <el-button
                  style="margin-left: auto"
                  v-if="addStrokeArr.length > 1"
                  @click="deleteAddStrokeRoute(item,index,item.route_id)"
                  plain
                  size="mini"
                  type="danger"
                  icon="el-icon-delete"
                  circle/>
            </div>
          </div>

          <div class="table_content">
            <el-input
                type="textarea"
                :rows="4"
                placeholder="请输入乘客信息"
                v-model="addStrokePassengers">
            </el-input>
          </div>
        </div>

      </div>
      <div slot="footer" class="dialog-footer">
        <el-button @click="addStrokeDialog = false">取消</el-button>
        <el-button type="primary" @click="submitAddStroke" v-loading="addStrokeLoading">保存</el-button>
      </div>
    </el-dialog>

    <!-- 修改乘车区间弹窗 -->
    <el-dialog
        v-dialogDrag
        title="修改乘车区间"
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        :show-close="false"
        modal-append-to-body
        append-to-body
        width="400px"
        :visible.sync="editTicketMessage"
        custom-class="edit_ticket_message_dialog">
      <div class="detail_main">
        <el-form label-width="80px">
          <el-form-item label="行程时间" class="edit_ticket_message_form">
            <el-date-picker
                :disabled="editTicketInfo.is_ticket_issue"
                v-model="new_riding_time"
                type="date"
                :placeholder="$getTimeYear(editTicketInfo.riding_time * 1000)">
            </el-date-picker>
          </el-form-item>
          <el-form-item label="发站" class="edit_ticket_message_form">
            <el-input :disabled="editTicketInfo.is_ticket_issue" class="edit_ticket_message_input" clearable
                      :placeholder="editTicketInfo.departure_station" v-model="new_departure_station"/>
            <el-select clearable style="width: 80px" v-model="departure_path" placeholder="方向">
              <el-option label="东" value="东"/>
              <el-option label="南" value="南"/>
              <el-option label="西" value="西"/>
              <el-option label="北" value="北"/>
            </el-select>
          </el-form-item>
          <el-form-item label="车次" class="edit_ticket_message_form">
            <el-input :placeholder="editTicketInfo.trips_number" :disabled="editTicketInfo.is_ticket_issue" clearable
                      v-model="new_trips_number"/>
          </el-form-item>
          <el-form-item label="到站" class="edit_ticket_message_form">
            <el-input :disabled="editTicketInfo.is_ticket_issue" class="edit_ticket_message_input" clearable
                      :placeholder="editTicketInfo.arrival_station" v-model="new_arrival_station"/>
            <el-select clearable style="width: 80px" v-model="arrival_path" placeholder="方向">
              <el-option label="东" value="东"/>
              <el-option label="南" value="南"/>
              <el-option label="西" value="西"/>
              <el-option label="北" value="北"/>
            </el-select>
          </el-form-item>
        </el-form>
      </div>
      <div slot="footer" class="dialog-footer">
        <el-button @click="editTicketMessage = false">取消</el-button>
        <el-button type="primary" v-loading="editTicketMessageLoading" @click="submitEditTicketMessage">保存</el-button>
      </div>
    </el-dialog>

    <!-- 选择12306账号弹窗 -->
    <el-dialog
        v-dialogDrag
        title="12306账号"
        :close-on-click-modal="false"
        modal-append-to-body
        append-to-body
        width="500px"
        :visible.sync="selectTicketMessage"
        custom-class="select_ticket_dialog">
      <div class="detail_main">
        <el-table
            ref="singleTable"
            :data="userTicketData"
            highlight-current-row
            @current-change="handleCurrentChange"
            border>
          <el-table-column
              label="序号"
              align="center"
              width="50px">
            <template slot-scope="scope">
              {{scope.$index+1}}
            </template>
          </el-table-column>
          <el-table-column
              label="12306账号"
              prop="account">
          </el-table-column>
          <el-table-column
              label="账号备注"
              prop="remarks">
          </el-table-column>
        </el-table>
        <div class="dialog_bottom_box" style="display: flex;align-items: flex-end;justify-content: space-between;">
          <Pagination
              ref="pagination"
              :pageData="userPaginationList"
              @jumpSize="userJumpSize"
              @jumpPage="userJumpPage">
          </Pagination>
          <el-button size="mini" type="primary" @click="extensionsDialog = true">修改插件ID</el-button>
        </div>
      </div>
    </el-dialog>
    <!--
    选择行程弹窗
    <el-dialog
        title="确定发站信息"
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        :show-close="false"
        modal-append-to-body
        append-to-body
        width="500px"
        :visible.sync="starTicketSite"
        custom-class="select_ticket_site">
      <div class="detail_main">
        <el-select @input="change($event)" v-model="starSite" placeholder="请选择">
          <el-option
              v-for="(item,index) in GetTicketData"
              :key="index"
              :label="item.name"
              :value="item.code">
          </el-option>
        </el-select>
      </div>
    </el-dialog>

    选择行程弹窗
    <el-dialog
        title="确定到站信息"
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        :show-close="false"
        modal-append-to-body
        append-to-body
        width="500px"
        :visible.sync="endTicketSite"
        custom-class="select_ticket_site">
      <div class="detail_main">
        <el-select @input="change($event)" v-model="endSite" placeholder="请选择">
          <el-option
              v-for="(item,index) in GetTicketData"
              :key="index"
              :label="item.name"
              :value="item.code">
          </el-option>
        </el-select>
      </div>
    </el-dialog>
-->
    <!-- 填写chrome扩展ID -->
    <el-dialog
        v-dialogDrag
        title="填写chrome扩展ID"
        :close-on-click-modal="false"
        :close-on-press-escape="false"
        :show-close="false"
        modal-append-to-body
        append-to-body
        width="500px"
        :visible.sync="extensionsDialog"
        custom-class="extensions_id_dialog">
      <div class="detail_main">
        <el-input placeholder="请填写已安装成功的chrome扩展ID" v-model="extensionsId"/>
      </div>
      <div slot="footer" class="dialog-footer">
        <el-button type="primary" @click="saveExtensionsId">保存</el-button>
      </div>
    </el-dialog>

  </div>
</template>

<script>
  import TrainTimesTable from '@/components/TrainTimesTable/index'

  import GetTicketData from '../../api/FeHelper-20191122183718'

  function sortNum(a,b) {
    return b - a;
  }

  export default {
    name: "orderDetails",
    components:{
      TrainTimesTable,
      // 'TrainTimesTable': () => import('@/components/TrainTimesTable/index'),
      'PublicImage':() => import('@/components/public/public_image'),
      'UploadLeaflet': () => import('@/components/UploadLeaflet/index'),
      'UploadMultiplePictures': () => import('@/components/UploadMultiplePictures/index'),
      'Pagination': () => import('@/components/Pagination')
    },
    data(){
      return {
        roleType: parseInt(sessionStorage.getItem('TYPE')),

        GetTicketData: GetTicketData,  // 12306行程代码

        extensionsId: sessionStorage.getItem('extensions_id') || '', // 扩展代码
        extensionsDialog: false,

        loading: true,
        orderSn: '', // 订单号

        urlType: '', // 页面类型
        inputDisabled: false, // 页面输入框禁用

        newsDetailDialog: false, // 新闻详情
        newsDetailInfo: {},

        showTableType: false, // 显示隐藏单元格

        tableRowRole: [], // 单元格权限列表
        tableRoleStatus: {}, // 单元格权限

        /***
         * 新增订单
         */
        AddGroupOriginData: '',  // 模糊查询Q群信息

        customerMessage: {}, // 识别客户商与发单人

        saveGroupMessage: '', // 初始信息保存
        addBtnType: false,  // 保存 or 识别按钮切换
        addBtnDisabled: false, // 识别按钮

        selectAllEditTable: {}, // 新增订单批量修改

        orderInfo: {
          receiving_address: '',
          ticket_photos: [],
          certificates: [],
          cname: '',
          dName: '',
        }, // 订单详情列表

        cname:  '', // 客户商
        customerList: [],  // 客户商列表
        dName: '',  // 发单人
        billerList: [], // 发单人列表

        issuerList: [], // 所有发单人列表

        addHeaderShow: false, // 新增订单显示原始信息

        headerDetails: false, // 原始Q群需求初始状态

        /***
         * 上传
         */
        userCardImage: '', // 证件照片

        fileList: [], // 上传文件列表

        ticketPhotoList: [], // 车票图片列表

        passengerInfo: [], // 乘客信息列表 筛选表格状态 0:单程 1：往返 2：中转 3：中转往返

        dbPassengerInfo: [], // 乘客信息列表备份

        showTrainTable: true, // 表格显示

        passengerSearch: { // 乘客信息搜索
          info: '',
          train_number: '',
          departure_station: '',
          arrive_station: '',
          newTripTime: '',
          newDrawBillTime: '',
          ticket_type: '',
          ticket_status: '',
        },

        addDataList: [], // 新增获取车次信息
        addTrainTableArray: [], // 新增获取乘客表格信息
        addTrainType: '', // 新增乘客车票类型

        allAddSubmitLoading: false,  // 新增订单加载

        selectPassengerList: [], // 乘客信息多选列表

        orderRemarks: [], // 订单备注列表

        orderLog: [], // 订单操作日志列表

        checkedOrderBtn: false, // 路线多选按钮
        checkedOrderList: '', // 多选列表

        /***
         * 编辑
         */
        orderId: '', // 订单id
        orderToken: '', // 订单token

        showPassengersTable: false, // 编辑页面表格显示

        newEditTableForm: [],
        newEditTableRouteForm: [],

        addRemarksMessage: '', // 新增备注信息

        addUserDialog: false, // 添加乘客弹窗
        userListHeader: '', // 新增弹窗表头信息
        addUserInfo: '', // 新增乘客输入框

        userListHeaderRoute: [], // 乘客ID

        user_data_photo: '',

        show_user_data: false, // 编辑 证件照片 上传框

        addUserPhotoDialog: false, // 证件照片上传框

        add_user_data: '', // 新增 证件照片上传
        add_file_data: [], // 新增 源文件上传
        addUserFileDialog: false,  // 上传原始文件弹窗

        checkedTableList: {}, // 表格乘客多选列表
        checkedRouteList: {}, // 表格路线多选列表
        editOrderToken: {},  // 路线token
        editOrderPrice: {}, // 票价

        orderRouteId: '', // 父数组下标
        orderTableId: '', // 子数组下标
        selectOrderId: 0, // 选择器自增下标
        deleteUserList: [],  // 多选删除乘客列表
        batchEditLoading: false, // 批量修改加载

        batchEditDialog: false, // 批量修改弹窗
        batchEditList: [], // 批量修改列表
        batchEditData: {  // 基本信息
          info: {
            information: [],
          }
        },

        checkedEditData: {},
        batchEditInfo: [],  // 批量修改数据
        dbBatchEditInfo: [], // 批量修改备份
        dbEditRouteData: {},
        selectTicketStatus: '', // 选择车票状态

        routeStatus: '', // 修改行程状态

        editRouteData: [], // 批量修改输入框数据

        editRouteDialog: false, // 批量修改路线变更提示弹窗
        agentCategory: [], // 获取席别列表

        editRouteInfo: [{
          riding_time: '',
          departure_station: '',
          trips_number: '',
          arrival_station: '',
        }], // 原始路线信息

        addStrokeDialog: false, // 新增行程弹窗
        strokeTableType: '单程', // 新增行程类型选择
        addStrokeArr:[{
          riding_time: '',  // 行程时间
          initial_station: '',  // 发站
          stop_station: '', // 到站
          trips_number: '',  // 车次
        }],
        addStrokePassengers: '', // 乘客信息
        addStrokeLoading: false, // 新增行程提交按钮加载


        editTicketMessage: false, // 修改乘车区间弹窗
        editTicketOrderInfo: {},  // 乘车区间订单信息
        editTicketInfo: {},  // 乘车区间路线信息
        new_departure_station: '', // 新发站
        new_arrival_station: '', // 新到站
        departure_path: '', // 发站方向
        arrival_path: '', // 到站方向
        new_trips_number: '', //新车次
        new_riding_time: '', // 新时间

        editTicketMessageLoading: false,  // 修改乘车区间提交按钮加载


        userPaginationList: {},  // 12306账号 分页
        userPer_page: 10,  // 13206账号 数据量
        userPage: '',  // 12306账号 页码
        userTicketData: [],  // 12306账号数据
        userOrderInfo: {},  // 当前买票时间路线人员信息
        selectTicketMessage: false, // 12306账号选择弹窗
        //
        // starTicketSite: false, // 选择发站弹窗
        // endTicketSite: false, // 选择到站弹窗
        // starSite: '', // 发站
        // endSite: '', // 到站

        paginationRemarksList: {},
        remarksPer_page: 10,
        remarksPage: '',

        paginationLogList: {},
        logPer_page: 10,
        logPage: ''
      }
    },
    watch: {
      '$route'(to, from) {
        this.urlTypeSelect()
        // this.getCustomerData()  // 获取客户商列表
      },
    },
    methods:{
      change(e){
        this.$forceUpdate()
      },

      /**
       * @Description: 下载所有图片
       * @author Wish
       * @date 2019/11/18
      */
      downAllPhoto(){
        this.$axios.get('/api/order/downloadImage/'+this.orderSn,{responseType: 'blob'})
            .then(res =>{
              let link = document.createElement('a');
              link.style.display = 'none';

              link.href = URL.createObjectURL(res.data); //创建一个指向该参数对象的URL
              link.download = this.orderSn+ '车票照片包.zip';
              link.click(); // 触发下载
              URL.revokeObjectURL(link.href);
            })
      },

      /**
       * @Description: 下载所有源文件
       * @author Wish
       * @date 2019/12/12
      */
      filesDownload(){
        this.$axios.get('/api/order/downloadFile/'+this.orderSn,{responseType: 'blob'})
            .then(res =>{
              let link = document.createElement('a');
              link.style.display = 'none';

              link.href = URL.createObjectURL(res.data); //创建一个指向该参数对象的URL
              link.download = this.orderSn+ '源文件包.zip';
              link.click(); // 触发下载
              URL.revokeObjectURL(link.href);
            })
      },

      /**
       * @Description: 获取订单详情
       * @author Wish
       * @date 2019/10/17
      */
      getDataList(){
        this.loading = true
        let data = {
          order_sn: this.orderSn,
        }
        this.$axios.post('/api/order/details',data)
            .then(res =>{
              if(res.data.code === 0){
                this.loading = false
                this.orderInfo = res.data.result[0]

                this.show_user_data = !!this.orderInfo.certificates
                if(this.orderInfo.certificates){
                  this.orderInfo.certificates = this.orderInfo.certificates.split(',')
                }else {
                  this.orderInfo.certificates = []
                }
                if(this.orderInfo.ticket_photos){
                  this.orderInfo.ticket_photos = this.orderInfo.ticket_photos.split(',')
                }else {
                  this.orderInfo.ticket_photos = []
                }
              }else {
                this.$message.warning(res.data.msg)
              }
            })
      },


      /**
       * @Description: 获取新闻详情
       * @author Wish
       * @date 2019/11/4
      */
      openNewsCenter(val){
        this.$message.success('正在获取新闻内容，请稍后')
        this.$axios.get('/api/notice/showOne/1/'+val.id)
            .then(res =>{
              if(res.data.code === 0){
                this.newsDetailInfo = res.data.result[0]
                this.newsDetailDialog = true
              }else {
                this.$message.warning(res.data.msg)
              }
            })
      },

      /**
       * @Description: 页面类型
       * @author Wish
       * @date 2019/10/30
      */
      urlTypeSelect(){
        console.log(this.$route);
        if(this.$route.name === 'orderDetails'){  // 详情页面
          this.orderSn = this.$route.query.order_sn
          this.urlType = 'details'
          this.inputDisabled = true
        }else if(this.$route.name === 'editOrder'){  // 修改页面
          this.orderSn = this.$route.query.order_sn
          this.urlType = 'edit'
          this.inputDisabled = false
        }else if(this.$route.name === 'addOrder'){  // 新增页面
          this.urlType = 'add'
          this.inputDisabled = true
          this.loading = false
        }

        if(this.urlType !== 'add'){
          this.getDataList()  // 订单数据
          this.getPassengerList()  // 乘客数据
          this.getOrderRemarks()  // 订单备注数据
          this.getOrderLog()  // 订单操作日志数据
        }
      },

      /**
       * @Description: 打开or关闭原始Q群需求
       * @author Wish
       * @date 2019/10/17
      */
      openHeaderDetailsBtn(){
        this.headerDetails = this.headerDetails === false
      },

      /**
       * @Description: 获取分路线乘客信息
       * @author Wish
       * @date 2019/10/17
      */
      getPassengerList(){
        this.loading = true;
        this.showPassengersTable = false
        this.$axios.get('/api/order/detailsRoute/'+this.orderSn)
            .then(res =>{
              this.showPassengersTable = true
              this.loading = false
              this.passengerInfo = res.data
              let ticketNumber = 0
              let ticketPrice = 0
              this.passengerInfo.forEach((item,index) =>{
                let r = Math.floor(Math.random()*255);
                let g = Math.floor(Math.random()*255);
                let b = Math.floor(Math.random()*255);
                item['color'] = 'rgba('+ r +','+ g +','+ b +',1)'
                this.passengerInfo[index]['itemIndex'] = index
                this.newEditTableForm.push({
                  express_fee: '', // 快递费
                  refund_fare: '', // 退改交通费
                })
                item.express_fee = item.express_fee?item.express_fee: '0.00'
                item.refund_fare = item.refund_fare?item.refund_fare: '0.00'
                item.route_config.forEach((cItem,cIndex) =>{
                  item.route_config[cIndex]['cItemIndex'] = cIndex
                  this.newEditTableRouteForm.push({
                    ticket_check: '',  // 检票口
                  })

                  if(cIndex < item.route_config.length){
                    ticketNumber += cItem.numberSheet
                    if(cItem.totalPrice !== 0){
                      ticketPrice += cItem.totalPrice
                    }
                    this.passengerInfo[index]['ticketNumber'] = ticketNumber
                    this.passengerInfo[index]['ticketPrice'] =  Math.floor(ticketPrice * 100) / 100
                  }
                })
                ticketNumber = 0
                ticketPrice = 0
              })

              this.dbPassengerInfo = JSON.parse(JSON.stringify(this.passengerInfo))
              this.getOrderLog()
            })
      },

      /**
       * @Description: 乘客信息搜索
       * @author Wish
       * @date 2019/10/17
      */
      passengerSearchBtn(){
        this.loading = true;
        this.showTrainTable = false
        this.showPassengersTable = false
        this.passengerSearch['trip_time'] = JSON.parse(JSON.stringify(this.passengerSearch.newTripTime / 1000))
        this.passengerSearch['draw_bill_time'] = JSON.parse(JSON.stringify(this.passengerSearch.newDrawBillTime / 1000))
        this.$axios.post('/api/order/detailsRoute/'+this.orderSn,this.passengerSearch)
            .then(res =>{
              this.showTrainTable = true
              this.showPassengersTable = true
              this.loading = false
              let ticketNumber = 0
              let ticketPrice = 0
              this.passengerInfo = res.data
              this.passengerInfo.forEach((item,index) =>{
                console.log(item, index);
                let r = Math.floor(Math.random()*255);
                let g = Math.floor(Math.random()*255);
                let b = Math.floor(Math.random()*255);
                item['color'] = 'rgba('+ r +','+ g +','+ b +',1)'
                this.passengerInfo[index]['itemIndex'] = index
                this.newEditTableForm.push({
                  express_fee: '', // 快递费
                  refund_fare: '', // 退改交通费
                })
                item.express_fee = item.express_fee?item.express_fee: '0.00'
                item.refund_fare = item.refund_fare?item.refund_fare: '0.00'
                item.route_config.forEach((cItem,cIndex) =>{
                  item.route_config[cIndex]['cItemIndex'] = cIndex
                  this.newEditTableRouteForm.push({
                    ticket_check: '',  // 检票口
                  })

                  if(cIndex < item.route_config.length){
                    ticketNumber += cItem.numberSheet
                    if(cItem.totalPrice !== 0){
                      ticketPrice += cItem.totalPrice
                    }
                    this.passengerInfo[index]['ticketNumber'] = ticketNumber
                    this.passengerInfo[index]['ticketPrice'] =  Math.floor(ticketPrice * 100) / 100
                  }
                })
                ticketNumber = 0
                ticketPrice = 0
              })
              this.dbPassengerInfo = JSON.parse(JSON.stringify(this.passengerInfo))

            })
      },

      /**
       * @Description: 隐藏乘车信息表格按钮
       * @author Wish
       * @date 2019/10/17
      */
      hiddenTable(){
        this.showTableType = this.showTableType !== true
      },

      /**
       * @Description: 批量购票
       * @author Wish
       * @date 2019/11/19
      */
      selectJumpPay(){
        let ticketNumber = 0

        this.batchEditList = []
        // let newTokenArr = []
        for(let key in this.checkedTableList){
          ticketNumber += this.checkedTableList[key].length
          this.batchEditList.push({
            token: String(this.editOrderToken[key]),
            route_id: String(this.checkedRouteList[key]),
            passengers: String(this.checkedTableList[key])
          })
          // newTokenArr.push(this.editOrderToken[key])
        }
        if(ticketNumber > 5){
          this.$message.warning('批量购票最多仅支持5人')
        }else {
          if(this.extensionsId) {
            this.userOrderInfo = {
              order_sn: this.orderId,
              info: JSON.stringify(this.batchEditList)
            }
            this.getUserAccountList()
          }else {
            this.extensionsDialog = true
          }
        }
      },

      /**
       * @Description: 跳转12306购票页面
       * @author Wish
       * @date 2019/11/18
      */
      jumpPayTicket(userInfo,orderInfo){
        if(this.extensionsId){
          let info = []
          info.push({
            "token": orderInfo.parent_id, //行程标识
            "route_id": userInfo.route, //路线标识
            "passengers": userInfo.id, //乘客ID
          })
          this.userOrderInfo = {
            "order_sn": orderInfo.order_sn, //订单号
            info: JSON.stringify(info)
          }
          console.log(this.userOrderInfo);
          this.$message.success('正在整理您的12306账号列表，请勿刷新页面')
          this.getUserAccountList()
        }else {
          this.extensionsDialog = true
        }

      },

      /**
       * @Description: 跳转12306 退票or改签
       * @author Wish
       * @date 2019/11/21
       */
      jumpEditTicket(userInfo,orderInfo,type){
        if(this.extensionsId){
          userInfo['type'] = type
          window.chrome.runtime.sendMessage(this.extensionsId, {data:{action:type,order:userInfo}},
              function(response) {});
          window.open("https://kyfw.12306.cn/otn/resources/login.html",'_blank')
        }else {
          this.extensionsDialog = true
        }
      },

      /**
       * @Description: 获取12306账号
       * @author Wish
       * @date 2019/11/18
      */
      getUserAccountList(){
        let data ={
          page: this.userPage || null,
        }
        this.$axios.get('/api/system/12306_account/showMe/'+this.userPer_page,{params:data})
            .then(res =>{
              if(res.data.code === 0){
                this.userTicketData = res.data.result.data
                this.userPaginationList = res.data.result
                this.selectTicketMessage = true
              }else {
                this.$message.warning(res.data.msg)
                this.selectTicketMessage = false
              }
            })
      },

      /**
       * @Description: 12306账号选择分页器
       * @author Wish
       * @date 2019/11/18
      */
      userJumpSize(val){
        this.userPer_page = val
        this.getUserAccountList()
      },
      userJumpPage(val){
        this.userPage = val
        this.getUserAccountList()
      },
      /**
       * @Description: 12306账号单选
       * @author Wish
       * @date 2019/11/18
      */
      handleCurrentChange(val) {
        this.$axios.post('/api/plug/getData',this.userOrderInfo)
            .then(res =>{
              if(res.data.code === 0){
                console.log(res.data.result);
                res.data.result.forEach((item,index) =>{
                  item['toSiteCode'] = ''
                  item['formSiteCode'] = ''
                  GetTicketData.forEach(citem =>{
                        if(citem.name === item.departure_station){
                          item['toSiteCode'] = citem.code
                        }
                        if(citem.name === item.arrival_station){
                          item['formSiteCode'] = citem.code
                        }
                      })
                })
                let userAccount = {}
                userAccount['account'] = val.account
                userAccount['password'] = val.password
                userAccount['info'] = res.data.result
                let _that = this
                chrome.runtime.sendMessage(this.extensionsId, {data:{action:"buy",order:userAccount}},
                    function(response) {
                    });
                window.open("https://kyfw.12306.cn/otn/resources/login.html",'_blank')
                _that.selectTicketMessage = false
              }else {
                this.$message.warning(res.data.msg)
              }
            })

      },


      /**
       * @Description: 储存chrome扩展Id
       * @author Wish
       * @date 2019/11/23
      */
      saveExtensionsId(){
        if(this.extensionsId){
          sessionStorage.setItem('extensions_id',this.extensionsId)
        }
        this.extensionsDialog = false
      },

      /**
       * @Description: 获取订单跟踪备注列表
       * @author Wish
       * @date 2019/10/17
      */
      getOrderRemarks(){
        let data ={
          page: this.remarksPage || null
        }
        this.$axios.post('/api/order/trackingRemarks/'+this.orderSn+'/'+this.remarksPer_page,data)
            .then(res =>{
              if(res.data.code === 0){
                this.orderRemarks = res.data.result.data
                this.paginationRemarksList = res.data.result
              }else {
                this.$message.warning(res.data.msg)
              }
            })
      },
      /**
       * @Description: 分页器
       * @author Wish
       * @data 2019/10/17
       */
      jumpRemarksSize(val){
        this.remarksPer_page = val
        this.getOrderRemarks()
      },
      jumpRemarksPage(val){
        this.remarksPage = val
        this.getOrderRemarks()
      },

      /**
       * @Description: 获取订单操作日志列表
       * @author Wish
       * @date 2019/10/17
      */
      getOrderLog(){
        let data = {
          page: this.logPage || null
        }
        this.$axios.post('/api/order/actionLog/'+this.orderSn+'/'+this.logPer_page,data)
            .then(res =>{
              if(res.data.code === 0){
                this.orderLog = res.data.result.data
                this.paginationLogList = res.data.result
              }else {
                this.$message.warning(res.data.msg)
              }
            })
      },
      /**
       * @Description: 分页器
       * @author Wish
       * @data 2019/10/17
       */
      jumpLogSize(val){
        this.logPer_page = val
        this.getOrderLog()
      },
      jumpLogPage(val){
        this.logPage = val
        this.getOrderLog()
      },

      /**
       * @Description: 获取客户商列表
       * @author Wish
       * @date 2019/10/30
      */
      getCustomerData(){
        this.$axios.get('/api/user/customer/showAll')
          .then(res =>{
            if(res.data.code === 0){
              this.customerList = res.data.result
            }
          })
      },
      /**
       * @Description: 获取发单人列表
       * @author Wish
       * @date 2019/10/30
      */
      getBillerData(data,id){
        if(data){
          this.customerList.forEach(res => {
            if(res.identity === data){
              this.billerList = res.issuer
              this.orderInfo['dName'] = ''

            }
          })
        }
      },

      /**
       * @Description: 打开车票图片上传
       * @author Wish
       * @data 2019/11/7
      */
      openUploadBox(){
        this.$refs.uploadImage.$el.children[0].children[0].children[0].children[1].click()
      },

      /**
       * @Description: 上传证件照片
       * @author Wish
       * @date 2019/11/1
      */
      uploadIdPhoto(val){
        this.userCardImage = val
      },

      /**
       * @Description: 打开上传证件照片弹窗
       * @author Wish
       * @date 2019/12/2
      */
      openAddUserPhotoBtn(){
        this.addUserPhotoDialog = true
      },

      /**
       * @Description: 上传证件照片
       * @author Wish
       * @date 2019/12/2
      */
      uploadUserPhoto(val){
        this.orderInfo.certificates.push(val)
        this.$refs.uploadImage.closedImage()
      },

      /**
       * @Description: 删除证件照片
       * @author Wish
       * @date 2019/12/2
      */
      deleteUserImage(val){
        this.orderInfo.certificates.splice(this.orderInfo.certificates.findIndex(item => item === val), 1);
      },

      /**
       * @Description: 打开源文件上传弹窗
       * @author Wish
       * @date 2019/12/12
       */
      openAddUserFileBtn(){
        this.addUserFileDialog = true
      },
      /**
       * @Description: 新增原文件上传
       * @author Wish
       * @date 2019/12/2
       */
      uploadFileData(val){
        console.log(val);
        this.add_file_data.push(val)
        this.$refs.uploadFile.closedImage()
        console.log(this.add_file_data);
      },

      /**
       * @Description: 删除新增源文件
       * @author Wish
       * @date 2019/12/12
      */
      deleteAddFileList(val,index){
        this.add_file_data.splice(this.add_file_data.findIndex(item => item === val), 1);
      },

      /**
       * @Description: 上传车票图片
       * @author Wish
       * @date 2019/11/1
      */
      uploadIdTicketPhoto(val){
        this.orderInfo.ticket_photos.push(val)
        this.$refs.uploadImage.closedImage()
      },

      /**
       * @Description: 删除上传的车票照片
       * @author Wish
       * @date 2019/12/2
      */
      deleteUploadTicketImage(val){
        this.orderInfo.ticket_photos.splice(this.orderInfo.ticket_photos.findIndex(item => item === val), 1);
      },

      /**
       * @Description: 路线多选
       * @author Wish
       * @date 2019/10/30
      */
      checkedOrderData(val,cVal){
        // console.log(val, cVal);
        if(this.checkedOrderBtn){
          this.checkedOrderList = val
        }
      },
      /**
       * @Description: 编辑按钮
       * @author Wish
       * @date 2019/10/30
      */
      openEditBtn(){
        this.$routerTab.open({
          path: '/editOrder',
          title: '订单编辑',
          refresh: true,
          query:{
            order_sn: this.$route.query.order_sn,
            type: 'edit'
          }
        })
        // this.closedSelectList()
        // this.inputDisabled = false
        this.urlType = 'edit'
        this.getBillerData(this.orderInfo.cname)  // 获取发单人列表
      },

      /**
       * @Description: 路线乘车区间修改
       * @author Wish
       * @date 2019/11/14
      */
      openEditTicketBrn(val,cVal){
        console.log(val, cVal);
        this.editTicketMessage = this.urlType === 'edit'
        this.editTicketOrderInfo = val  // 乘车区间订单信息
        this.editTicketInfo = cVal  // 乘车区间路线信息
        this.new_departure_station = '' // 新发站
        this.new_arrival_station = '' // 新到站
        this.departure_path = '' // 发站方向
        this.arrival_path = '' // 到站方向
        this.new_trips_number = '' //新车次
        this.new_riding_time = '' // 新时间
      },

      /**
       * @Description: 提交乘车区间修改
       * @author Wish
       * @date 2019/11/14
      */
      submitEditTicketMessage(){
        this.editTicketMessageLoading = true
        let editTicketType = 1

        if(this.$dateToMs(this.new_riding_time) !== '' && this.editTicketInfo.riding_time !==  this.$dateToMs(this.new_riding_time) / 1000 || this.editTicketInfo.trips_number !== this.new_trips_number && this.new_trips_number !== '' || this.editTicketInfo.departure_station !== this.new_departure_station && this.new_departure_station !== '' || this.editTicketInfo.arrival_station !== this.new_arrival_station  && this.new_arrival_station !== ''){
          editTicketType = 0
        }
        let newForm = {}
        newForm['departure_station'] = this.new_departure_station? this.new_departure_station + this.departure_path: this.editTicketInfo.departure_station + this.departure_path
        newForm['arrival_station'] = this.new_arrival_station? this.new_arrival_station + this.arrival_path: this.editTicketInfo.arrival_station + this.arrival_path
        newForm['trips_number'] = this.new_trips_number? this.new_trips_number: this.editTicketInfo.trips_number
        newForm['riding_time'] = this.new_riding_time? this.$dateToMs(this.new_riding_time) / 1000 : this.editTicketInfo.riding_time
        let data = {
          order_sn: this.editTicketOrderInfo.order_sn,
          token: this.editTicketOrderInfo.parent_id,
          route: this.editTicketInfo.id,
          info: JSON.stringify(newForm)
        }
        this.$axios.post('/api/order/editRouteInfo/'+ editTicketType,data)
            .then(res =>{
              if(res.data.code === 0){
                this.editTicketMessageLoading = false
                this.$message.success('保存成功')
                this.editTicketMessage = false
                this.getPassengerList()
              }else {
                this.$message.warning(res.data.msg)
                this.editTicketMessageLoading = false
              }
            })
      },

      /**
       * @Description: 行程信息单元格修改
       * @author Wish
       * @date 2019/12/4
      */
      editTableHeaderRows(data, name, oldData, newData){
        console.log(data);
        if(oldData !== newData && newData !== ''){
          let infoData = {
            field: name,
            value: newData
          }
          let param = {
            order_sn: data.order_sn,
            token: data.parent_id,
            info: JSON.stringify(infoData)
          }
          this.$axios.post('/api/order/editCellValue/2',param)
              .then(res =>{
                if(res.data.code === 0){
                  this.$message.success('修改成功')
                  this.newEditTableForm = []
                  this.getPassengerList()
                }else {
                  this.$message.warning(res.data.msg)
                  this.newEditTableForm = []
                  this.getPassengerList()
                }
              })

        }
      },

      /**
       * @Description: 检票口单元格修改
       * @author Wish
       * @date 2019/12/4
      */
      editTableHeaderBows(data, cData, name, oldData, newData){
        if(oldData !== newData && newData !== ''){
          let infoData = {
            field: name,
            value: newData
          }
          let param = {
            order_sn: data.order_sn,
            token: data.parent_id,
            route_id: cData.id,
            info: JSON.stringify(infoData)
          }
          this.$axios.post('/api/order/editCellValue/1',param)
          .then(res =>{
            if(res.data.code === 0){
              this.$message.success('修改成功')
              this.newEditTableRouteForm = []
              this.getPassengerList()
            }else {
              this.$message.warning(res.data.msg)
              this.newEditTableRouteForm = []
              this.getPassengerList()
            }
          })
        }
      },

      /**
       * @Description: 单元格修改
       * @author Wish
       * @data 2019/11/7
      */
      editTableRows(orderInfo, data, rowName, row ){
        /**
         * @Description: 遍历数组对比相同乘客路线，输出当前路线id
         * @author Wish
         * @data 2019/11/7
        */
        let routeId
        orderInfo.route_config.forEach(item =>{
          item.passengers.data.forEach(cItem =>{
            if(cItem.id === data.id){
              routeId = item.id
            }
          })
        })
        let infoData = {}
        infoData['passenger_id'] = data.id
        infoData['field'] = rowName === 'account' ? '12306_account': rowName
        infoData['value'] = row
        let param ={
          order_sn: orderInfo.order_sn,
          token: orderInfo.parent_id,
          route_id: routeId,
          info: JSON.stringify(infoData),
        }
        this.$axios.post('/api/order/editCellValue/0',param)
          .then(res =>{
            if(res.data.code === 0){
              this.$message.success('修改成功')
              this.getPassengerList()
            }else {
              this.$message.warning(res.data.msg)
              this.getPassengerList()
            }
          })

      },

      /**
       * @Description: 修改客户资料
       * @author Wish
       * @date 2019/12/12
      */
      tableRowsUserData(orderInfo, data, rowName, row){
        /**
         * @Description: 遍历数组对比相同乘客路线，输出当前路线id
         * @author Wish
         * @data 2019/11/7
         */
        let routeId
        orderInfo.route_config.forEach(item =>{
          item.passengers.data.forEach(cItem =>{
            if(cItem.id === data.id){
              routeId = item.id
            }
          })
        })
        let infoData = {}
        // infoData['passenger_id'] = data.id
        infoData['field'] = rowName === 'account' ? '12306_account': rowName
        infoData['value'] = row
        let param ={
          order_sn: orderInfo.order_sn,
          token: orderInfo.parent_id,
          route: routeId,
          passenger_id: data.id,
          info: JSON.stringify(infoData),
        }
        this.$axios.post('/api//order/modifyPassengerInfo',param)
            .then(res =>{
              if(res.data.code === 0){
                this.$message.success('修改成功')
                this.getPassengerList()
              }else {
                this.$message.warning(res.data.msg)
                this.getPassengerList()
              }
            })
      },

      /**
       * @Description: 新增备注信息
       * @author Wish
       * @date 2019/10/30
      */
      submitNewRemarsk(){
        if(this.addRemarksMessage){
          let data ={
            order_sn: this.orderInfo.order_sn,
            remarks: this.addRemarksMessage,
            is_important: 0
          }
          this.$axios.post('/api/order/operateRemarks',data)
              .then(res =>{
                if(res.data.code === 0){
                  this.$message.success('添加成功')
                  this.getOrderRemarks()
                  this.addRemarksMessage = ''
                }else {
                  this.$message.warning(res.data.msg)
                }
              })
        }else {
          this.$message.warning('请填写备注信息')
        }
      },

      /**
       * @Description: 删除行程
       * @author Wish
       * @date 2019/12/2
      */
      deleteTableUserBtn(val,cVal){
        let data ={
          order_sn: val.order_sn,
          token: val.parent_id,
          route: cVal.id
        };

        this.$confirm('此操作将永久删除该路线，可能会改变当前数据信息, 是否继续?', '提示', {
          confirmButtonText: '确定',
          cancelButtonText: '取消',
          type: 'warning'
        }).then(() => {
          this.$axios.post('/api/order/delTrips/1',data)
              .then(res =>{
                if(res.data.code === 0){
                  this.$message.success('删除成功')
                  this.getPassengerList()
                }else {
                  this.$message.warning(res.data.msg)
                }
              })
        }).catch(() => {});

      },

      /**
       * @Description: 新增乘客
       * @author Wish
       * @date 2019/10/30
      */
      addTableUserBtn(val){
        this.addUserDialog = true
        this.addUserInfo = ''
        let type = 0
        let data ={
          order_sn: val.order_sn,
          token: val.parent_id
        }
        this.$axios.post('/api/order/routeInfo/'+type,data)
            .then(res =>{
              console.log(res);
              if(res.data.code === 0){
                this.userListHeader = res.data.result[0]
                if(this.userListHeader){
                  this.userListHeader.info.forEach(item =>{
                    this.userListHeaderRoute.push(item.route_id)
                  })
                  console.log(this.userListHeaderRoute);
                }
              }else {
                this.$message.warning(res.data.msg+'，将于两秒后关闭弹窗')
                this.addUserDialog = false
              }
            })

      },

      /**
       * @Description: 添加乘客删除路线
       * @author Wish
       * @date 2019/12/10
      */
      deleteAddUserRoute(val,index,valId){
        if(this.$refs.add_user_table_header[index].className === 'order_table_header hidden'){
          this.$refs.add_user_table_header[index].className = 'order_table_header'
          this.userListHeaderRoute.push(valId)
          this.userListHeaderRoute = [...new Set(this.userListHeaderRoute)]
        }else {
          this.$refs.add_user_table_header[index].className = 'order_table_header hidden'
          let i = this.userListHeaderRoute.indexOf(valId)
          this.userListHeaderRoute.splice(i,1)
        }
      },

      /**
       * @Description: 确认添加乘客按钮
       * @author Wish
       * @date 2019/10/30
      */
      submitAddUserDialog(){
        if(this.addUserInfo){
          let data ={
            order_sn: this.userListHeader.order_sn,
            token: this.userListHeader.parent_id,
            passengers: this.addUserInfo,
            routes: String([...new Set(this.userListHeaderRoute)])
          }
          if(this.userListHeaderRoute.length > 0){
            this.$axios.post('/api/order/routeInfo/addPassengers',data)
                .then(res =>{
                  if(res.data.code === 0){
                    this.$message.success('添加成功')
                    this.addUserDialog = false
                    this.getPassengerList()
                  }
                })
          }else {
            this.$message.warning('请至少选中一条路线')
          }

        }else {
          this.$message.warning('请填写乘客信息')
        }
      },

      /**
       * @Description: 表格多选
       * @author Wish
       * @date 2019/10/30
      */
      checkTableList(userId,userRoute, routeIndex, tableIndex,orderId, token, userTicketPrice){
        this.checkedTableList[String(routeIndex)+String(tableIndex)] = userId
        this.checkedRouteList[String(routeIndex)+String(tableIndex)] = userRoute
        this.editOrderToken[String(routeIndex)+String(tableIndex)] = token

        this.editOrderPrice[String(routeIndex)+String(tableIndex)] = userTicketPrice  // 票价

        if(this.checkedTableList[String(routeIndex)+String(tableIndex)].length < 1){
          delete this.checkedTableList[String(routeIndex)+String(tableIndex)]
        }
        if(this.checkedRouteList[String(routeIndex)+String(tableIndex)].length < 1){
          delete this.checkedRouteList[String(routeIndex)+String(tableIndex)]
        }
        if(this.editOrderToken[String(routeIndex)+String(tableIndex)].length < 1){
          delete this.editOrderToken[String(routeIndex)+String(tableIndex)]
        }
        if(this.editOrderPrice[String(routeIndex)+String(tableIndex)].length < 1){
          delete this.editOrderPrice[String(routeIndex)+String(tableIndex)]
        }

        this.orderId = orderId
      },
      /**
       * @Description: 清空表格多选
       * @author Wish
       * @data 2019/11/15
      */
      closedSelectList(){
        this.checkedTableList = {}
        this.checkedRouteList = {}
        this.editOrderToken = {}
        this.orderId = ''
        this.orderToken = ''
        this.deleteUserList = []
        this.batchEditList = []
      },
      /**
       * @Description: 删除乘客列表
       * @author Wish
       * @date 2019/10/30
      */
      deleteOrderList(){
        this.deleteUserList = []
        for(let key in this.checkedTableList){
          this.deleteUserList.push({
            token: String(this.editOrderToken[key]),
            route_id: String(this.checkedRouteList[key]),
            passengers: String(this.checkedTableList[key])
          })
        }
        if(this.deleteUserList.length > 0){
          this.$confirm('此操作将永久所选乘客, 是否继续?', '提示', {
            confirmButtonText: '确定',
            cancelButtonText: '取消',
            type: 'warning'
          }).then(() => {
            let data = {
              order_sn: this.orderId,
              info: JSON.stringify(this.deleteUserList)
            }
            // console.log(data);
            this.$axios.post('/api/order/operate/delPassengers',data)
              .then(res =>{
                if(res.data.code === 0){
                  this.$message.success('删除成功')
                  this.getPassengerList()
                  this.closedSelectList()
                }else {
                  this.$message.warning(res.data.msg)
                }
              })
          }).catch(() => {});
        }else {
          this.$message.warning('请选择需要删除的数据')
        }


      },

      /**
       * @Description: 关闭批量修改弹窗
       * @author Wish
       * @date 2019/11/11
      */
      closedEditDialog(){
        this.batchEditDialog = false
        this.getPassengerList()
        this.closedSelectList()
        this.batchEditInfo.forEach(item =>{
          item.disabled = false
        })
      },

      /**
       * @Description: 打开批量修改弹窗
       * @author Wish
       * @date 2019/11/1
      */
      openBatchEdit(){
        console.log(this.editOrderPrice);
        this.batchEditList = []
        let newTokenArr = []
        let newPriceArr = []
        for(let key in this.checkedTableList){
          this.batchEditList.push({
            route_id: String(this.checkedRouteList[key]),
            passengers: String(this.checkedTableList[key])
          })
          newTokenArr.push(this.editOrderToken[key])
          newPriceArr.push(this.editOrderPrice[key])
        }
        newTokenArr = Array.from([...new Set(newTokenArr)])
        if(this.batchEditList.length > 0){
          if(newTokenArr.length <= 1){
            this.batchEditLoading = true
            this.$message.success('正在整理所选路线乘客信息，请勿刷新页面')
            let newArr = {}
            newArr['token'] = newTokenArr[0]
            newArr['information'] = this.batchEditList

            let data ={
              order_sn: this.orderId,
              info: JSON.stringify(newArr)
            }
            this.$axios.post('/api/order/routeInfo/1',data)
                .then(res =>{
                  if(res.data.code === 0){
                    this.batchEditDialog = true
                    this.batchEditLoading = false
                    this.batchEditData = res.data.result
                    this.batchEditInfo = JSON.parse(JSON.stringify(this.batchEditData.info.information))
                    console.log(this.batchEditInfo);
                    this.batchEditInfo.forEach((item,index) =>{
                      item.route[0].riding_time = item.route[0].riding_time * 1000
                      item['editPriceData'] = newPriceArr[index].sort(sortNum)[0] || 0
                      item['disabled'] = false
                      item['riding_time']= '' // 行车日期
                      item['departure_station']= '' // 发站
                      item['arrival_station']= '' // 到站
                      item['trips_number']= '' // 车次
                      item['ticket_type']= ''  // 票类
                      item['fwId']= ''  // 席别席位
                      item['ticket_price']= ''  // 票价
                      item['child_ticket_price']= ''  // 儿童票价
                      item['missed_meals_money']= ''  // 误餐费
                      item['ticket_fare']= ''  // 出票费
                      item['refund_fee']= '' // 退票费
                      item['payment_account'] = ''  //支付账号
                      item['payment_flow_number'] = ''  // 支付流水号
                      item['12306_account'] = ''  // 12306 账号
                      item['password'] = ''  // 12306密码
                      item['ticket_status'] = '请选择'
                      // item.ticket_status = item.ticket_status === 0 ? '未出票':
                      //     item.ticket_status === 1 ? '已出票':
                      //         item.ticket_status === 2 ? '已取消票':
                      //             item.ticket_status === 3 ? '已改签':
                      //                 item.ticket_status === 4 ? '已退票': item.ticket_status
                    })
                    this.dbBatchEditInfo = JSON.parse(JSON.stringify(this.batchEditInfo))
                  }else {
                    this.batchEditLoading = false
                    this.$message.warning(res.data.msg)
                  }
                })

            this.$axios.get('/api/system/fareWell/showAll/1')
                .then(res =>{
                  if(res.data.code === 0){
                    this.agentCategory = res.data.result
                  }else {
                    this.$message.warning(res.data.msg + ' 请重新打开批量修改弹窗以获取数据')
                  }
                })
          }else {
            this.$message.warning('只可选择一个行程类型下的乘客')
          }
        }else {
          this.$message.warning('请选择需要修改的数据')
        }

      },

      /**
       * @Description: 根据票类修改出票费
       * @author Wish
       * @date 2019/12/3
      */
      selectTicketType(val,index){
        this.batchEditInfo[index].ticket_fare = val !== '1'? '5' : '0'
        this.batchEditInfo[index].missed_meals_money = '5'
        console.log(this.batchEditInfo[index]);
      },

      /**
       * @Description: 关闭路线变更提示框
       * @author Wish
       * @date 2019/11/12
      */
      closedEditRoute(){
        this.editRouteData.riding_time = ''
        this.editRouteData.departure_station = ''
        this.editRouteData.arrival_station = ''
        this.editRouteData.trips_number = ''
        this.editRouteDialog = false
      },
      /**
       * @Description: 路线变更确认按钮
       * @author Wish
       * @date 2019/11/12
      */
      submitEditRoute(val){
        console.log(val);
        console.log(this.dbEditRouteData);
        this.editRouteDialog = false
        let newForm = {}  // 路线信息
        newForm['type'] = 0
        newForm['route_id'] = this.editRouteData.route_id
        newForm['passengers'] = this.editRouteData.passengers
        newForm['riding_time'] =  this.dbEditRouteData.route[0].riding_time / 1000 || val.riding_time / 1000
        newForm['trips_number'] = this.dbEditRouteData.route[0].trips_number || val.trips_number

        if(this.dbEditRouteData.route[0].departure_station){
          newForm['departure'] = this.editRouteData.directionOne? this.dbEditRouteData.route[0].departure_station +this.editRouteData.directionOne:this.dbEditRouteData.route[0].departure_station
        }else {
          newForm['departure'] = this.editRouteData.directionOne? val.departure_station +this.editRouteData.directionOne:val.departure_station
        }
        if(this.dbEditRouteData.route[0].arrival_station){
          newForm['arrive'] = this.editRouteData.directionTwo? this.dbEditRouteData.route[0].arrival_station +this.editRouteData.directionTwo:this.dbEditRouteData.route[0].arrival_station
        }else {
          newForm['arrive'] = this.editRouteData.directionTwo? val.arrival_station +this.editRouteData.directionTwo:val.arrival_station
        }

        let newEditForm = {}  // 修改输入框信息
        newEditForm['ticket_type'] = this.editRouteData.ticket_type
        newEditForm['fwId'] = this.editRouteData.fwId
        newEditForm['ticket_price'] = this.editRouteData.ticket_price
        newEditForm['child_ticket_price'] = this.editRouteData.child_ticket_price
        newEditForm['missed_meals_money'] = this.editRouteData.missed_meals_money
        newEditForm['ticket_fare'] = this.editRouteData.ticket_fare
        newEditForm['refund_fee'] = this.editRouteData['refund_fee'] || ''

        let info = {}
        info['condition'] = []
        info['params'] = newEditForm
        info.condition.push(newForm)
        let newToken = ''
        for(let key in this.checkedTableList){
          newToken = String(this.editOrderToken[key])
        }
        let data = {
          order_sn: this.orderId,
          token: newToken,
          ticket_status: this.routeStatus,
          info: JSON.stringify(info)
        }
        // console.log(data);
        this.$axios.post('/api/order/routeInfo/editBatch',data)
            .then(res =>{
              if(res.data.code === 0){
                this.$message.success('保存成功')
              }else {
                this.$message.warning(res.data.code)
              }
            })
      },

      /**
       * @Description: 批量修改提交
       * @author Wish
       * @date 2019/11/1
      */
      saveEditBtn(status,editData,route,rowIndex){
        console.log(status,editData,route,rowIndex);

        this.routeStatus = status
        this.editRouteInfo = route  // 获取原路线信息
        this.editRouteData = editData  // 获取当前输入框数据

        this.dbEditRouteData = this.dbBatchEditInfo[rowIndex]
        console.log(this.editRouteInfo);
        console.log(this.editRouteData);
        let editInfo = {}
        editInfo['route_id'] = this.editRouteData.route_id
        editInfo['passengers'] = this.editRouteData.passengers

        if(status === '3'){
          if(parseFloat(this.editRouteData.ticket_price) < parseFloat(this.editRouteData.editPriceData)){
            this.$message.warning('当前修改项最高票价为 '+ this.editRouteData.editPriceData + ' ，请勿修改低于此票价的值')
            return false;
          }
          console.log(parseFloat(this.editRouteData.ticket_price));
          console.log(parseFloat(this.editRouteData.editPriceData));
        }
        if(status === '4'){
          if(parseFloat(this.editRouteData.refund_fee) > parseFloat(this.editRouteData.editPriceData)){
            this.$message.warning('当前修改项最高票价为 '+ this.editRouteData.editPriceData + ' ，请勿修改高于此票价的值')
            return false;
          }
        }

        this.batchEditInfo[rowIndex].disabled = true

        // domData.toElement.disabled = true
        // domData.toElement.classList.add('is-disabled')



        if(status === '0'){  // 未出票
          console.log(status, editData, route);
          editInfo['fwId'] = this.editRouteData.fwId
          editInfo['ticket_type'] = this.editRouteData.ticket_type
          editInfo['ticket_price'] = this.editRouteData.ticket_price
          editInfo['child_ticket_price'] = this.editRouteData.child_ticket_price
          editInfo['missed_meals_money'] = this.editRouteData.missed_meals_money
          editInfo['ticket_fare'] = this.editRouteData.ticket_fare
          // editInfo['refund_fee'] = this.editRouteData.refund_fee
          editInfo['payment_account'] = this.editRouteData.payment_account
          editInfo['payment_flow_number'] = this.editRouteData.payment_flow_number
          editInfo['12306_account'] = this.editRouteData['12306_account']
          editInfo['password'] = this.editRouteData.password
          let newEditArr = []
          newEditArr.push(editInfo)
          let newToken = ''
          for(let key in this.checkedTableList){
            newToken = String(this.editOrderToken[key])
          }
          let data = {
            order_sn: this.orderId,
            token: newToken,
            ticket_status: status,
            info: JSON.stringify(newEditArr)
          }
          this.$axios.post('/api/order/routeInfo/editBatch',data)
              .then(res =>{
                if(res.data.code === 0){
                  this.$message.success('保存成功')
                }else {
                  this.$message.warning(res.data.code)
                }
              })
        }else if(status === '5' || status === '请选择'){  // 啥都没选
          if(this.dbBatchEditInfo[rowIndex].route[0].riding_time !== this.editRouteInfo[rowIndex].riding_time || this.dbBatchEditInfo[rowIndex].route[0].departure_station !== this.editRouteInfo[rowIndex].departure_station || this.dbBatchEditInfo[rowIndex].route[0].arrival_station !== this.editRouteInfo[rowIndex].arrival_station || this.dbBatchEditInfo[rowIndex].route[0].trips_number !== this.editRouteInfo[rowIndex].trips_number){
            this.routeStatus = 5
            this.editRouteDialog = true
          }else{
            let newForm = {}  // 路线信息
            newForm['type'] = 1
            newForm['route_id'] = this.editRouteData.route_id
            newForm['passengers'] = this.editRouteData.passengers
            newForm['riding_time'] =  this.dbBatchEditInfo[rowIndex].route[0].riding_time? this.dbBatchEditInfo[rowIndex].route[0].riding_time / 1000 : ''
            newForm['departure'] = this.editRouteData.directionOne?this.dbBatchEditInfo[rowIndex].route[0].departure_station + this.editRouteData.directionOne:this.dbBatchEditInfo[rowIndex].route[0].departure_station
            newForm['arrive'] = this.editRouteData.directionTwo?this.dbBatchEditInfo[rowIndex].route[0].arrival_station + this.editRouteData.directionTwo:this.dbBatchEditInfo[rowIndex].route[0].arrival_station
            newForm['trips_number'] = this.dbBatchEditInfo[rowIndex].route[0].trips_number || ''

            console.log(newForm);
            console.log(this.dbBatchEditInfo[rowIndex]);

            let newEditForm = {}  // 修改输入框信息
            newEditForm['ticket_type'] = this.editRouteData.ticket_type
            newEditForm['fwId'] = this.editRouteData.fwId
            newEditForm['ticket_price'] = this.editRouteData.ticket_price
            newEditForm['child_ticket_price'] = this.editRouteData.child_ticket_price
            newEditForm['missed_meals_money'] = this.editRouteData.missed_meals_money
            newEditForm['ticket_fare'] = this.editRouteData.ticket_fare
            // newEditForm['refund_fee'] = this.editRouteData.refund_fee
            newEditForm['payment_account'] = this.editRouteData.payment_account
            newEditForm['payment_flow_number'] = this.editRouteData.payment_flow_number
            newEditForm['12306_account'] = this.editRouteData['12306_account']
            newEditForm['password'] = this.editRouteData.password

            let info = {}
            info['condition'] = []
            info['params'] = newEditForm
            info.condition.push(newForm)

            let newToken = ''
            for(let key in this.checkedTableList){
              newToken = String(this.editOrderToken[key])
            }

            let data = {
              order_sn: this.orderId,
              token: newToken,
              ticket_status: 5,
              info: JSON.stringify(info)
            }
            console.log(data);
            this.$axios.post('/api/order/routeInfo/editBatch',data)
                .then(res =>{
                  if(res.data.code === 0){
                    this.$message.success('保存成功')
                  }else {
                    this.$message.warning(res.data.code)
                  }
                })

          }

        }else if(status === '1' || status === '3'){  // 出票or改签
          if(this.dbBatchEditInfo[rowIndex].route[0].riding_time !== this.editRouteInfo[rowIndex].riding_time || this.dbBatchEditInfo[rowIndex].route[0].departure_station !== this.editRouteInfo[rowIndex].departure_station || this.dbBatchEditInfo[rowIndex].route[0].arrival_station !== this.editRouteInfo[rowIndex].arrival_station || this.dbBatchEditInfo[rowIndex].route[0].trips_number !== this.editRouteInfo[rowIndex].trips_number){
            this.editRouteDialog = true
          }else{
            let newForm = {}  // 路线信息
            newForm['type'] = 1
            newForm['route_id'] = this.editRouteData.route_id
            newForm['passengers'] = this.editRouteData.passengers
            newForm['riding_time'] = this.dbBatchEditInfo[rowIndex].route[0].riding_time ?this.dbBatchEditInfo[rowIndex].route[0].riding_time / 1000 : ''
            newForm['departure'] = this.editRouteData.directionOne?this.dbBatchEditInfo[rowIndex].route[0].departure_station + this.editRouteData.directionOne:this.dbBatchEditInfo[rowIndex].route[0].departure_station
            newForm['arrive'] = this.editRouteData.directionTwo?this.dbBatchEditInfo[rowIndex].route[0].arrival_station + this.editRouteData.directionTwo:this.dbBatchEditInfo[rowIndex].route[0].arrival_station
            newForm['trips_number'] = this.dbBatchEditInfo[rowIndex].route[0].trips_number || ''

            let newEditForm = {}  // 修改输入框信息
            newEditForm['ticket_type'] = this.editRouteData.ticket_type
            newEditForm['fwId'] = this.editRouteData.fwId
            newEditForm['ticket_price'] = this.editRouteData.ticket_price
            newEditForm['child_ticket_price'] = this.editRouteData.child_ticket_price
            newEditForm['missed_meals_money'] = this.editRouteData.missed_meals_money
            newEditForm['ticket_fare'] = this.editRouteData.ticket_fare
            // newEditForm['refund_fee'] = this.editRouteData.refund_fee
            newEditForm['payment_account'] = this.editRouteData.payment_account
            newEditForm['payment_flow_number'] = this.editRouteData.payment_flow_number
            newEditForm['12306_account'] = this.editRouteData['12306_account']
            newEditForm['password'] = this.editRouteData.password

            let info = {}
            info['condition'] = []
            info['params'] = newEditForm
            info.condition.push(newForm)

            let newToken = ''
            for(let key in this.checkedTableList){
              newToken = String(this.editOrderToken[key])
            }

            let data = {
              order_sn: this.orderId,
              token: newToken,
              ticket_status: status,
              info: JSON.stringify(info)
            }
            console.log(data);
            this.$axios.post('/api/order/routeInfo/editBatch',data)
                .then(res =>{
                  if(res.data.code === 0){
                    this.$message.success('保存成功')
                  }else {
                    this.$message.warning(res.data.code)
                  }
                })

          }

        }else if(status === '2'){  // 取消票
          let newEditArr = []
          newEditArr.push(editInfo)
          let newToken = ''
          for(let key in this.checkedTableList){
            console.log(key);
            newToken = String(this.editOrderToken[key])
          }
          let data = {
            order_sn: this.orderId,
            token: newToken,
            ticket_status: status,
            info: JSON.stringify(newEditArr)
          }
          this.$axios.post('/api/order/routeInfo/editBatch',data)
              .then(res =>{
                if(res.data.code === 0){
                  this.$message.success('保存成功')
                }else {
                  this.$message.warning(res.data.code)
                }
              })

        }else if(status === '4'){  // 退票
          editInfo['refund_fee'] = this.editRouteData['refund_fee'] || ''
          let newEditArr = []
          newEditArr.push(editInfo)
          let newToken = ''
          for(let key in this.checkedTableList){
            newToken = String(this.editOrderToken[key])
          }
          let data = {
            order_sn: this.orderId,
            token: newToken,
            ticket_status: status,
            info: JSON.stringify(newEditArr)
          }
          this.$axios.post('/api/order/routeInfo/editBatch',data)
            .then(res =>{
              if(res.data.code === 0){
                this.$message.success('保存成功')
              }else {
                this.$message.warning(res.data.code)
              }
            })
        }

      },

      /**
       * @Description: 新增行程
       * @author Wish
       * @date 2019/11/14
      */
      addStrokeBtn(){
        this.addStrokeDialog = true
        this.strokeTableType = '单程'
        this.addStrokeArr = [{
          riding_time: '',  // 行程时间
          initial_station: '',  // 发站
          stop_station: '', // 到站
          trips_number: '',  // 车次
          is_add_passenger: true,
        }]
        this.addStrokePassengers = ''
      },

      /**
       * @Description: 新增行程删除路线
       * @author Wish
       * @date 2019/12/10
      */
      deleteAddStrokeRoute(val,index,valId){
        console.log(val, index, valId);
        if(this.addStrokeArr[index].is_add_passenger){
          this.$refs.add_stroke_table_box[index].className = 'header_box hidden'
          this.addStrokeArr[index].is_add_passenger = false
        }else {
          this.$refs.add_stroke_table_box[index].className = 'header_box'
          this.addStrokeArr[index].is_add_passenger = true
        }
      },

      /**
       * @Description: 切换新增行程显示状态
       * @author Wish
       * @date 2019/11/14
      */
      changeStrokeType(val){
        this.$refs.add_stroke_table_box.forEach(item =>{
          item.classList = 'header_box'
        })
        this.addStrokePassengers = ''
        if(this.strokeTableType === '单程'){
          this.addStrokeArr = [{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          }]
        }else if(this.strokeTableType === '往返'){
          this.addStrokeArr = [{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          },{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          }]
        }else if(this.strokeTableType === '中转'){
          this.addStrokeArr = [{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          },{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          },{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          }]
        }else if(this.strokeTableType === '中转往返'){
          this.addStrokeArr = [{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          },{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          },{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          },{
            riding_time: '',  // 行程时间
            initial_station: '',  // 发站
            stop_station: '', // 到站
            trips_number: '',  // 车次
            is_add_passenger: true,
          }]
        }

      },

      /**
       * @Description: 提交新增行程
       * @author Wish
       * @date 2019/11/14
      */
      submitAddStroke(){
        let newArr = []
        let submitType = false
        newArr = JSON.parse(JSON.stringify(this.addStrokeArr))
        newArr.forEach(item =>{
          item.riding_time = this.$dateToDate(item.riding_time)
          submitType = true
        })

        let data ={
          order_sn: this.$route.query.order_sn,
          type: this.strokeTableType === '单程' ? 0 :
              this.strokeTableType === '往返' ? 1 :
                  this.strokeTableType === '中转' ? 2 :
                      this.strokeTableType === '中转往返' ? 3 : '',
          passengers: this.addStrokePassengers,
          info: JSON.stringify(newArr)
        }
        console.log(data);
        if(submitType){
          this.addStrokeLoading = true
          this.$axios.post('/api/order/addTrips',data)
              .then(res =>{
                if(res.data.code === 0){
                  this.addStrokeDialog = false
                  this.$message.success('保存成功')
                  this.addStrokeLoading = false
                  this.getPassengerList()
                }else {
                  this.$message.warning(res.data.msg)
                }
              })
        }
      },

      /**
       * @Description: 提交全部编辑信息
       * @author Wish
       * @date 2019/10/30
      */
      allEditSubmit(){
        this.allAddSubmitLoading = true
        let cname
        let dname
        this.customerList.forEach(item =>{
          if(item.name === this.orderInfo.cname){
            cname = item.identity
            item.issuer.forEach(cItem =>{
              if(cItem.name === this.orderInfo.dName){
                dname = cItem.id
              }
            })
          }
        })
        let newPhoto = []
        newPhoto = JSON.parse(JSON.stringify(this.orderInfo.ticket_photos))
        // this.orderInfo.ticket_photos?this.orderInfo.ticket_photos.forEach(img =>{
        //   newPhoto.push(img)
        // }): ''
        let data ={
          order_sn: this.orderInfo.order_sn,
          old_order_sn: this.orderInfo.old_order_sn,
          receiving_address: this.orderInfo.receiving_address,  // 发货地址
          customer: cname,
          issuer: dname,
          remarks: this.orderInfo.remarks,
          certificates: String(this.orderInfo.certificates),
          ticket_photos: String(newPhoto),
        }
        this.$axios.post('/api/order/edit',data)
          .then(res =>{
            if(res.data.code === 0){
              this.$message.success('保存成功')
              this.urlTypeSelect()
              this.getCustomerData()
              this.$routerTab.close({
                to: 'orderDetails?order_sn='+this.orderInfo.order_sn+'&type=details',
                refresh: true
              })
            }else {
              this.$message.warning(res.data.msg)
              this.urlTypeSelect()
              this.getCustomerData()
              this.allAddSubmitLoading = false
            }
          })
      },

      /**
       * @Description: 新增Q群信息
       * @author Wish
       * @date 2019/10/18
      */
      saveGroupBtn(){
        this.addBtnType = true
        this.addHeaderShow = true
        this.saveGroupMessage = JSON.parse(JSON.stringify(this.AddGroupOriginData))
      },
      addGroupBtn(){
        this.addTrainTableArray = []
        if(this.AddGroupOriginData){
          this.$message.success('数据识别中')
          this.addBtnDisabled = true
          let data ={
            group_origin_data: this.AddGroupOriginData
          }
          this.$axios.post('/api/order/recognize/new',data)
              .then(res =>{
                if(res.data.code === 0){
                  this.$message.success('识别完成')
                  this.inputDisabled = false
                  this.addBtnDisabled = false
                  this.addDataList = res.data.result
                  this.customerMessage =  res.data.result.customer
                  this.orderInfo.order_sn = this.addDataList.orderNumber.new || this.addDataList.customer.custom_order_sn
                  // this.orderInfo.order_sn = ''
                  this.orderInfo.old_order_sn = this.addDataList.orderNumber.old || ''
                  // this.orderInfo.old_order_sn = ''

                  this.customerList.forEach(customer =>{
                    if(customer.identity === this.customerMessage.customer){
                      this.orderInfo.cname = customer.name
                    }
                    console.log(customer);
                    customer.issuer.forEach(issuing =>{
                      if(issuing.id ===  this.customerMessage.issuing_clerk){
                        this.orderInfo.dName = issuing.name
                      }
                    })
                  })


                  console.log(this.customerList);

                  console.log(this.customerMessage);
                  /**
                   * @Description: 重组新增数组
                   * @author Wish
                   * @date 2019/10/24
                   */

                  console.log(this.addDataList.trips.length > 0);
                  if(this.addDataList.trips.length > 0){
                      this.addDataList.trips.forEach(item =>{
                        let r = Math.floor(Math.random()*255);
                        let g = Math.floor(Math.random()*255);
                        let b = Math.floor(Math.random()*255);
                        item['color'] = 'rgba('+ r +','+ g +','+ b +',1)'
                        item.info.forEach(cItem =>{
                          console.log(cItem);
                          cItem['initial_station'] = cItem.route[0]  // 发站
                          cItem['stop_station'] = cItem.route[1] // 到站
                          cItem['riding_time'] = cItem.ride_date * 1000 // 发车时间
                          cItem['trips_number'] = cItem.train_number  // 车次
                          delete cItem.route
                          delete cItem.ride_date
                          delete cItem.train_number
                          cItem.passenger.forEach(dItem =>{
                            console.log(dItem);
                            dItem['IDCard'] = dItem.card  // 身份证
                            dItem['ticket_species'] = dItem.is_child === 0 ? '成人票' :'儿童票'   // 车票类型
                            dItem['ticket_type'] = ''
                            dItem['remarks'] = ''  // 备注
                            dItem['missed_meals_money'] = '0'  // 误餐费
                            delete dItem.card
                            delete dItem.is_child
                          })
                        })
                      })
                      this.addTrainTableArray = JSON.parse(JSON.stringify(this.addDataList.trips))
                    }else {
                      this.addDataList.trips.info.forEach(cItem =>{
                        cItem['initial_station'] = cItem.route[0]  // 发站
                        cItem['stop_station'] = cItem.route[1] // 到站
                        cItem['riding_time'] = cItem.ride_date  * 1000 // 发车时间
                        cItem['trips_number'] = cItem.train_number  // 车次
                        delete cItem.route
                        delete cItem.ride_date
                        delete cItem.train_number
                        cItem.passenger.forEach(dItem =>{
                          dItem['IDCard'] = dItem.card  // 身份证
                          dItem['ticket_species'] = dItem.is_child === 0 ? '成人票' :'儿童票'   // 车票类型
                          dItem['ticket_type'] = this.addDataList.ticketType
                          dItem['remarks'] = ''  // 备注
                          dItem['missed_meals_money'] = '0'  // 误餐费
                          delete dItem.card
                          delete dItem.is_child
                        })
                      })
                      this.addTrainTableArray.push(JSON.parse(JSON.stringify(this.addDataList.trips)))
                    }
                }else {
                  this.addBtnDisabled = false
                  this.$message.warning(res.data.msg)
                }
              })
              .catch(() =>{
                this.$message.error('识别失败，请检查格式后重新识别')
                this.addBtnDisabled = false
              })
        }else {
          this.$message.warning('请输入订单原始信息')
        }
      },

      /**
       * @Description: 删除按钮
       * @author Wish
       * @date 2019/10/25
      */
      deleteList(list,data){
        return list.splice(list.findIndex(item => item.IDCard === data.IDCard), 1)
      },

      /**
       * @Description: 多选按钮
       * @author Wish
       * @date 2019/10/25
      */
      tableSelect(v,d){
        d['checked'] = !d['checked'];
        console.log(v,d);
      },

      /**
       * @Description: 新增批量修改按钮
       * @author Wish
       * @date 2019/12/10
      */
      addSelectAllTableData(){
        this.addTrainTableArray.map(item =>{
          item.info.map(cItem =>{
            cItem.passenger.map(dItem =>{
              if(dItem.checked){
                dItem.ticket_species = this.selectAllEditTable.ticket_species?this.selectAllEditTable.ticket_species: dItem.ticket_species
                dItem.ticket_type = this.selectAllEditTable.ticket_type?this.selectAllEditTable.ticket_type:dItem.ticket_type
                dItem.remarks = this.selectAllEditTable.remarks?this.selectAllEditTable.remarks:dItem.remarks
                dItem.missed_meals_money = this.selectAllEditTable.missed_meals_money?this.selectAllEditTable.missed_meals_money:dItem.missed_meals_money
              }
            })
          })
        })

        console.log(this.addTrainTableArray);
      },

      /**
       * @Description: 新增证件照片上传
       * @author Wish
       * @date 2019/12/2
      */
      uploadUserData(val){
        this.add_user_data = val
      },

      /**
       * @Description: 新增全部保存
       * @author Wish
       * @date 2019/10/22
      */
      allAddSubmit(){
        this.allAddSubmitLoading = true
        let orderList = []
        orderList = JSON.parse(JSON.stringify(this.addTrainTableArray))
        console.log(orderList);
        orderList.forEach(item =>{
          item.info.forEach(cItem =>{
            cItem.riding_time = this.$dateToDate(cItem.riding_time)  // 发车时间
            cItem.passenger.forEach(dItem =>{
              dItem.ticket_type = dItem.ticket_type === '电子票' ? 0:
                  dItem.ticket_type === '网票' ? 1:
                      dItem.ticket_type === '纸票' ? 2: '' // 车票类型 0:电子票、1:网票、2:纸票
              console.log(dItem.ticket_species);
              console.log(dItem.missed_meals_money);
              dItem.ticket_species = dItem.ticket_species === '成人票' ? 0 : dItem.ticket_species === '儿童票'? 1: 0   // 车票类型
            })
          })
        })
        let customerName
        let issuingClerkName
        if(isNaN(this.orderInfo.cname)){
          customerName = this.customerMessage.customer
          issuingClerkName = this.customerMessage.issuing_clerk
        }
        let data ={
          order_sn: this.orderInfo.order_sn, // 主订单号
          old_order_sn: this.orderInfo.old_order_sn,  // 旧订单号
          customer: customerName, // 客户商标识
          issuer: issuingClerkName, // 发单人标识
          receiving_address: this.orderInfo.receiving_address,  // 发货地址
          origin_data: this.saveGroupMessage, // Q群原始信息
          route_type: 0,
          certificates: String(this.orderInfo.certificates),
          source_file: String(this.add_file_data),
          ticket_photos: '',
          remarks: this.orderInfo.remarks || '',
          route: JSON.stringify(orderList),
        }
        this.$axios.post('/api/order/add',data)
            .then(res =>{
              if(res.data.code === 0){
                this.$message.success('保存成功')
                setTimeout(() =>{
                  this.$routerTab.close({
                    to: 'orderDetails?order_sn='+this.orderInfo.order_sn+'&type=details',
                    refresh: true
                  })
                },300)

              }else {
                this.$message.warning(res.data.msg)
                this.allAddSubmitLoading = false
              }
            })
      },

    },
    created() {

      this.urlTypeSelect()

      this.getCustomerData()  // 获取客户商列表
    },
    mounted() {
      if(this.$route.query.type === 'edit'){
        this.deleteUserList = []
      }

      let FieldInfoAll  = JSON.parse(sessionStorage.getItem('FieldInfoAll'))
      let FieldInfo = JSON.parse(sessionStorage.getItem('FieldInfo'))
      FieldInfoAll.forEach(item =>{
        this.tableRoleStatus[item.field] = {
          show: false,
          read: false
        }
        FieldInfo.forEach(cItem =>{
          if(item.field === cItem.field){
            if(item.type === 0){
              this.tableRoleStatus[item.field] = {
                show: true,
                read: true
              }
            }
          }
        })
      })

    }
  }
</script>

<style scoped lang="less">
  /deep/.el-input{
    &.is-disabled{
      .el-input__inner{
        background: transparent;
        border: unset;
        color: black;
        cursor: text;
        &::placeholder{
          color: #c0c4cc;
        }
      }
      .el-input__suffix{
        display: none;
      }
    }
  }
  /deep/.el-textarea{
    &.is-disabled{
      .el-textarea__inner{
        background: transparent;
        border: unset;
        color: black;
        cursor: text;
        &::placeholder{
          color: #c0c4cc;
        }
      }
    }
  }

  .el-dialog__wrapper {
    display: block;
    align-items: unset;
    justify-content: unset;
    position: fixed !important;
    min-height: 900px;
    .el-dialog {
      margin: unset !important;
      top: 20%;
      left: 30%;
    }
  }

  // 新闻详情弹窗
  .news_detail_dialog{
    .detail_main{
      .title{
        font-size:24px;
        color:rgba(51,148,250,1);
        text-align: center;
        margin-bottom: 35px;
      }
      .info{
        display: flex;
        align-items: center;
        margin-bottom: 15px;
        .time{
          margin-left: 15px;
          font-size:16px;
          color:rgba(38,153,251,1);
        }
      }
      .content{
        font-size:18px;
        color:rgba(38,153,251,1);
        max-height: 600px;
        height: 100%;
        overflow-y: auto;
        margin-bottom: 30px;
        white-space: pre-wrap;
      }
      .person_box{
        >span{
          &:not(:last-child){
            &:after{
              content: '，'
            }
          }
        }
      }
    }
  }

  // 新增行程弹窗
  .add_stroke_dialog{
    .add_stroke_table{
      margin-top: 10px;
      .table_header{
        margin-bottom: 10px;
        .header_box{
          height: 64px;
          display: flex;
          align-items: center;
          background: #eef7ff;
          padding: 0 10px;
          justify-content: space-between;
          &.hidden{
            opacity: .5;
          }
          &:not(:last-child){
            border-bottom: 2px solid #fff;
          }
          .header_ticket{
            display: flex;
            align-items: flex-start;
            /deep/.el-input{
              width: 120px;
            }
            .ticket_number{
              width: 110px;
              height: 30px;
              margin: 0 5px;
              position: relative;
              &::after{
                content: '';
                position: absolute;
                width: 90%;
                left: 0;
                bottom: -10px;
                height: 1px;
                background:  rgba(38,153,251,1);
              }
              &::before{
                content: '';
                position: absolute;
                right: 0;
                bottom: -15px;
                width: 0;
                height: 0;
                border-top: 6px solid transparent;
                border-bottom: 6px solid transparent;
                border-left: 6px solid rgba(38,153,251,1);
              }
              /deep/.el-input__inner{
                height: 100%;
                line-height: 30px;
              }
            }
          }
        }
      }
      .table_content{
        /deep/.el-textarea__inner{
          max-height: 200px;
        }
      }
    }
  }

  /*修改乘车区间弹窗*/
  .edit_ticket_message_dialog{
    .edit_ticket_message_form{
      /deep/.el-form-item__content{
        display: flex;
        align-items: center;
        .edit_ticket_message_input{
          .el-input__inner{

          }
        }
      }
      /deep/.el-input__inner{

      }
    }
  }

  /*选择12306账号弹窗*/
  .select_ticket_dialog{

  }

  .orderDetails{
    padding: 20px 80px 0;
    position: relative;
    .edit_order_btn{
      padding: 12px 50px;
      margin-bottom: 34px;
    }
    .order_header{
      width: 100%;
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      .header_title{
        flex: 1;
        background:rgba(238,247,255,1);
        border-radius:7px;
        height: 40px;
        display: inline-flex;
        align-items: center;
        padding-left: 15px;
        cursor: pointer;
        color:rgba(38,153,251,1);
        >i{
          margin-right: 10px;
        }
      }
      .header_btn{
        margin-left: 20px;
        /*color: #606266;*/
        /*border: 1px solid #DCDFE6;*/
        /*padding: 12px 20px;*/
        /*border-radius: 4px;*/
      }
    }

    .order_header_add{
      display: flex;
      align-items: center;
      margin-bottom: 40px;
      .add_title{
        width: 150px;
        flex-shrink: 0;
      }
      .add_input{
        width: 100%;
      }
      .add_btn{
        margin-left: 20px;
      }
    }


    .header_header_details{
      background:rgba(238,247,255,1);
      margin-bottom: 40px;
      padding: 15px;
      width: 100%;
    }

    // 新增
    .addOrderTable{
      margin-bottom: 30px;
      /deep/.add_order_table{
        .el-table__header{
          tr{
            .el-table-column--selection{
              .cell{
                padding: 0 3px;
                &::before{
                  content: '选择';
                  color: #909399;
                  font-weight: bold;
                }
                .el-checkbox{
                  display: none;
                }
              }
            }
          }
        }

        td{
          padding: 2px 0;
        }
        .el-input__inner{
          height: 18px;
          line-height: 18px;
        }
        .el-input__suffix{
          .el-input__suffix-inner{
            .el-input__icon{
              line-height: 22px;
            }
          }
        }
        /deep/.el-button{
          padding: 2px 15px;
        }
      }
      .add_table_header{
        margin-bottom: 20px;
      }
      .table{
        .table_header{
          display: flex;
          align-items: center;
          justify-content: space-between;
          padding: 0 20px;
          font-size:16px;
          color:rgba(51,148,250,1);
          width: 100%;
          height:50px;
          background:rgba(238,247,255,1);
          .table_header_train{
            display: flex;
            align-items: center;
            >div{
              margin: 0 10px;
            }
          }
        }
        .add_order_table{

        }
      }
    }


    // 详情or编辑
    .order_info{
      width: 100%;
      margin-bottom: 20px;
      .title{
        width: 100px;
        flex-shrink: 0;
        text-align: right;
        padding-right: 15px;
      }
      .info_header{
        display: flex;
        align-items: center;
        border: 1px solid #ebeef5;
        .info_header_table{
          flex: 1;
          display: flex;
          align-items: center;
          border-left: 1px solid #ebeef5;
          >div{
            display: flex;
            align-items: center;
            width: 100%;
            height: 46px;
            padding-left: 15px;
            /deep/.el-input__inner{
              color: black;
              &::placeholder{
                color: #606266;
              }
            }
            &:not(:last-child){
              border-right: 1px solid #ebeef5;
            }
            span{
              display: inline-flex;
              margin-right: 10px;
            }
          }
        }
      }
      .info_address{
        display: flex;
        align-items: center;
        border: 1px solid #ebeef5;
        border-top: unset;
        padding-right: 10px;
        .info_address_table{
          flex: 1;
          display: flex;
          align-items: center;
          border-left: 1px solid #ebeef5;
          >div {
            display: flex;
            align-items: center;
            width: 100%;
            height: 46px;
            padding-left: 15px;
          }
        }
      }
      .info_content{
        display: flex;
        align-items: center;
        border: 1px solid #ebeef5;
        border-top: unset;
        .info_content_table{
          display: flex;
          align-items: center;
          width: 100%;
          min-height: 100px;
          border-left: 1px solid #ebeef5;
          .info_remarks{
            flex: 1;
            height: 100%;
            border-right: 1px solid #ebeef5;
            padding: 15px;
          }
          .info_upload_image{
            width: 160px;
            flex-shrink: 0;
            /*height: 100px;*/
            display: flex;
            align-items: center;
            justify-content: center;
            flex-direction: column;
            /deep/.UploadLeaflet{
              .upload_main{
                width: 100%;
                height: 100%;
                .el-upload{
                  width: 100%;
                  height: 100%;
                  .el-upload-dragger{
                    width: 100%;
                    height: 100%;
                  }
                }
              }
            }
          }
        }
      }
      .add_upload{
        display: flex;
        align-items: center;
        justify-content: center;
        height: 55px;
        border: 1px solid #ebeef5;
        border-top: unset;
        .add_user_photo_btn{
          width: 50%;
          height: 100%;
          display: flex;
          align-items: center;
          justify-content: center;
          border-left: 1px solid #ebeef5;
        }
        /deep/.UploadLeaflet{
          .upload_main{
            width: 100%;
            height: 100%;
            .el-upload{
              width: 100%;
              height: 100%;
              .el-upload-dragger{
                width: 100%;
                height: 100%;
              }
            }
          }
        }
      }
      .info_upload{
        border: 1px solid #ebeef5;
        border-top: unset;
        min-height: 130px;
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 15px;
        .upload_image_main{
          display: flex;
          align-items: center;
          width: 100%;
          flex-wrap: wrap;
          /deep/.publicImage{
            margin-right: 40px;
            width: 140px;
            height: 100px;
          }
        }
        .ticket_photo_box{
          display: flex;
          align-items: center;
          /deep/.el-image{
            width: 100px;
            height: 100px;
            margin-right: 20px;
          }
        }
        .UploadLeaflet{
          width: 120px;
        }
        .publicImage{
          margin-bottom: 5px;
          &:not(:last-child){
            margin-right: 5px;
          }
        }
        .info_upload_right_box{
          display: flex;
          align-items: center;
          margin-left: 50px;
          .info_message_box{
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-direction: column;
            width: 120px;
            height: 100%;
            flex-shrink: 0;
            >p{
              height: 50px;
              display: flex;
              align-items: center;
              justify-content: center;
            }
          }
          .info_message_button{
            width: 145px;
            margin-left: 25px;
            padding-left: 25px;
            border-left: 1px solid #ebeef5;
            height: 100%;
            min-height: 100px;
            display: flex;
            align-items: center;
            justify-content: center;
          }
        }
      }

      .add_select_editTable{
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding-right: 10px;
        border: 1px solid #ebeef5;
        border-top: unset;
        .add_edit_table_box{
          display: flex;
          align-items: center;
          .title{}
          .add_edit_input_box{
            display: flex;
            align-items: center;
            padding: 5px 0 5px 15px;
            border-left: 1px solid #ebeef5;
            /deep/.el-input{
              margin-right: 10px;
            }
          }
        }
      }
    }

    .order_carousel{
      display: flex;
      align-items: center;
      margin-bottom: 20px;
      padding-left: 150px;
      .carousel_main{
        width: 500px;
        /deep/.el-carousel__item{
          display: flex;
          align-items: center;
          justify-content: space-between;
          .medium{
            margin-right: 30px;
            width: 450px;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            cursor: pointer;
          }
        }

      }
    }

    .order_passenger_search{
      margin-bottom: 20px;
      .search_box{
        display: flex;
        align-items: center;
        margin-bottom: 20px;
        /deep/.el-input{
          margin-right: 5px;
        }
      }
      .search_btn{
        display: flex;
        align-items: center;
        justify-content: space-between;
      }
    }


    .order_passenger{
      .passenger_table{
        margin-bottom: 20px;
        border: 1px solid #bbc4cc;
        /*/deep/.el-input{*/
        /*  .el-input__inner{*/
        /*    border: unset;*/
        /*  }*/
        /*}*/
        .train_route_message{
          height:40px;
          width: 100%;
          display: flex;
          align-items: center;
          justify-content: space-between;
          background:rgba(238,247,255,1);
          padding: 0 16px;
          font-size: 14px;
          color: #000;
          p{
            color: #1d4d4f;
            font-weight: bold;
          }
          span{
            color: #1d4d4f;
            font-weight: bold;
          }
          .ticket_message{
            padding: 0 10px;
            display: flex;
            align-items: center;
            height: 50px;
            >p{
              width: 90px;
              display: inline-flex;
              justify-content: center;
              height: 25px;
              margin: 0 18px;
              position: relative;
              &::after{
                content: '';
                position: absolute;
                width: 90%;
                left: 0;
                bottom: 0;
                border-bottom: 1px solid rgba(38,153,251,1);
                height: 1px;
              }
              &::before{
                content: '';
                position: absolute;
                right: 0;
                bottom: -5px;
                width: 0;
                height: 0;
                border-top: 6px solid transparent;
                border-bottom: 6px solid transparent;
                border-left: 6px solid rgba(38,153,251,1);
              }
            }
            &.edit_message{
              border-bottom: 1px solid transparent;
              transition: all .3s;
              cursor: pointer;

              &:hover{
                border-bottom: 1px solid rgba(38,153,251,1);
              }
            }
          }
          >div{
            display: inline-flex;
            align-items: center;
            /deep/.el-input{
              .el-input__inner{
                &::placeholder{
                  font-size: 14px;
                  /*color: #000;*/
                }
              }
            }
            /*&:not(:last-child){*/
            /*  margin-right: 10%;*/
            /*}*/
          }
        }

        .train_message{
          height: 35px;
          display: flex;
          align-items: center;
          border: 1px solid #eef7ff;
          padding: 0 16px;
          font-size: 12px;
          /deep/.el-input{
            width: 80px;
            .el-input__inner{
              font-size: 12px;
              &::placeholder{
                /*color: #000;*/
              }
            }
          }
          .table_header_btn{
            display: flex;
            align-items: center;
            margin-left: auto;
            /deep/.el-button{
              margin-left: 10px;
            }
          }
          >div{
            flex-shrink: 0;
            &:not(:last-child){
              margin-right: 5%;
            }
          }
          .addUserListBtn{
            margin-left: auto;
          }
        }
      }
    }

    .order_details_bottom{
      display: flex;
      .order_bottom_table{
        width: 50%;
        /deep/.orderRemarksTable{
          border: 1px solid red;
          td{
            font-size: 12px;
          }
        }
        /deep/.orderLogTable{
          border: 1px solid blue;
          td{
            font-size: 12px;
          }
        }
        .table_header{
          margin-bottom: 10px;
        }

        &:last-child{
          margin-left: 40px;
        }
      }
    }

    /*编辑 提交备注信息*/
    .order_add_remarks{
      display: flex;
      align-items: center;
      margin-bottom: 30px;
      /deep/.el-button{
        margin-left: 15px;
      }
    }
    /*提交按钮*/
    .submitAllDataBtn{
      display: flex;
      align-items: center;
      justify-content: center;
      height: 80px;
      width: 100%;
      min-width: 1450px;
      position: fixed;
      bottom: 0;
      left: 0;
      background: #fff;
      box-shadow: 0 2px 12px 0 rgba(0,0,0,.1);
      z-index: 99;
      /deep/.el-button{
        padding: 12px 60px;
      }

    }

    /*上传证件照片弹窗*/
    .add_user_photo_dialog{
      .dialog_main{
        display: flex;
        align-items: center;
        flex-wrap: wrap;
        min-height: 110px;
        .add_upload_files_box{
          display: flex;
          align-items: center;
          flex-wrap: wrap;
          width: 100%;
          .add_upload_file_list{
            width: 48%;
            height: 25px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 10px;
            padding: 0 10px;
            transition: all .3s;
            &:hover{
              background: #f6f6f6;
              span{
                opacity: 1;
              }
            }
            >p{
              display: inline;
              overflow: hidden;
              white-space: nowrap;
              text-overflow: ellipsis;
              width: 300px;
            }
            >span{
              opacity: 0;
              color: red;
              cursor: pointer;
            }
            &:nth-child(2n){
              margin-left: 4%;
            }
          }
        }
        .not_photo_message{
          margin: 0 auto;
          color: rgba(0,0,0,.5);
        }
        /deep/.publicImage{
          width: 100px;
          height: 100%;
          margin-left: unset;
          margin-bottom: 10px;
          &:not(:last-child){
            margin-right: 10px;
          }
        }
        .UploadLeaflet{

        }
      }
    }

    /*新增乘客弹窗*/
    .add_user_dialog{
      .dialog_main{
        width: 100%;
        height: 100%;
        padding: 20px 30px;
        .order_table_header{
          height:45px;
          width: 100%;
          display: flex;
          align-items: center;
          background:rgba(238,247,255,1);
          padding: 0 16px;
          position: relative;
          &.hidden{
            opacity: .5;
          }
          >div{
            display: inline-flex;
            align-items: center;
            &:not(:last-child){
              margin-right: 3%;
            }
            >p{
              width: 90px;
              display: inline-flex;
              justify-content: center;
              height: 25px;
              margin: 0 18px;
              position: relative;
              &::after{
                content: '';
                position: absolute;
                width: 90%;
                left: 0;
                bottom: 0;
                height: 1px;
                background:  rgba(38,153,251,1);
              }
              &::before{
                content: '';
                position: absolute;
                right: 0;
                bottom: -5px;
                width: 0;
                height: 0;
                border-top: 6px solid transparent;
                border-bottom: 6px solid transparent;
                border-left: 6px solid rgba(38,153,251,1);
              }
            }
          }
        }
        .order_user_message{
          /deep/.el-textarea__inner{
            border-radius: unset;
          }
        }
      }
    }

    /*批量编辑*/
    /deep/.batch_edit_dialog{
      min-width: 435px;
      .el-dialog__header{
        height: 40px;
        .el-dialog__title{
          font-size: 16px;
        }
      }
      .el-dialog__body{
        display: flex;
        align-items: flex-start;
        padding: 30px 0 0;
        overflow: auto;
        max-height: 700px;
      }
      .el-dialog__footer{
        .dialog-footer{
          .el-button{
            padding: 6px 35px;
            font-size: 14px;
          }
        }
      }

      .dialog_main{
        width: 100%;
        flex-shrink: 0;
        padding-right: 3%;
        &:first-child{
          padding-left: 3%;
        }

        .main_box{
          display: flex;
          align-items: center;
          border: 1px solid #ebeef5;
          min-height: 45px;
          &:not(:last-child){
            border-bottom: unset;
          }
          .main_box_title{
            padding-left: 8px;
            width: 90px;
            min-height: 45px;
            border-right: 1px solid #ebeef5;
            height: 100%;
            display: flex;
            align-items: center;
            font-size: 12px;
          }
          .main_box_content{
            width: 100%;
            height: 100%;
            padding: 5px;
            .content_route{
              display: flex;
              align-items: center;
              flex-wrap: wrap;
              .content_edit_time{
                width: 100%;
                /deep/.el-input{
                  width: 100%;
                }
              }
              .route_message{
                display: flex;
                align-items: center;
                margin-left: 10px;
                &.edit_route_message{
                  >span{
                    width: 120px;
                  }
                }

                >p{
                  width: 90px;
                  display: inline-flex;
                  justify-content: center;
                  margin: 0 18px;
                  position: relative;
                  /deep/.el-input{
                    .el-input__inner{
                      height: 25px;
                      line-height: 25px;
                    }
                    .el-input__suffix{
                      line-height: 25px;
                      height: 25px;
                      display: flex;
                      align-items: center;
                      justify-content: center;
                    }
                  }
                  /*&::after{*/
                  /*  content: '';*/
                  /*  position: absolute;*/
                  /*  width: 90%;*/
                  /*  left: 0;*/
                  /*  bottom: -10px;*/
                  /*  height: 1px;*/
                  /*  background:  rgba(38,153,251,1);*/
                  /*}*/
                  /*&::before{*/
                  /*  content: '';*/
                  /*  position: absolute;*/
                  /*  right: 0;*/
                  /*  bottom: -15px;*/
                  /*  width: 0;*/
                  /*  height: 0;*/
                  /*  border-top: 6px solid transparent;*/
                  /*  border-bottom: 6px solid transparent;*/
                  /*  border-left: 6px solid rgba(38,153,251,1);*/
                  /*}*/
                }
              }
            }
          }
        }
      }
    }

    /*批量编辑变更路线弹窗*/
    /deep/.edit_route_dialog{
      .detail_main{
        .edit_route_info{
          display: inline-flex;
          font-weight: bold;
          span{
            width: 90px;
            display: inline-flex;
            justify-content: center;
            margin: 0 18px;
            position: relative;
            &::after{
              content: '';
              position: absolute;
              width: 90%;
              left: 0;
              bottom: -10px;
              height: 1px;
              background:  rgba(38,153,251,1);
            }
            &::before{
              content: '';
              position: absolute;
              right: 0;
              bottom: -15px;
              width: 0;
              height: 0;
              border-top: 6px solid transparent;
              border-bottom: 6px solid transparent;
              border-left: 6px solid rgba(38,153,251,1);
            }
          }
        }
      }
    }

  }
</style>
